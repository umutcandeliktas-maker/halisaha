<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taktik Pro v35 - Ultra Freedom</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <style>
        body { background: #070b14; color: #f8fafc; font-family: 'Inter', sans-serif; overflow: hidden; height: 100vh; width: 100vw; }
        
        /* S√ºr√ºklenebilir Men√º Genel Stili */
        .draggable-menu {
            position: absolute; background: rgba(15, 23, 42, 0.95); 
            border: 1px solid #334155; border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5); z-index: 50;
            backdrop-filter: blur(10px); min-width: 200px;
        }
        
        /* Men√º Ba≈ülƒ±ƒüƒ± (Ta≈üƒ±ma Alanƒ±) */
        .menu-header {
            padding: 10px; background: rgba(30, 41, 59, 0.8);
            border-bottom: 1px solid #334155; border-radius: 12px 12px 0 0;
            cursor: move; display: flex; justify-content: space-between; align-items: center;
        }

        /* SAHA */
        .field { 
            width: 900px; height: 550px; background: #15803d; border: 4px solid #fff; position: relative;
            background-image: repeating-linear-gradient(90deg, transparent, transparent 90px, rgba(0,0,0,0.05) 90px, rgba(0,0,0,0.05) 180px);
        }
        .box-left { position: absolute; left: 0; top: 137px; width: 140px; height: 275px; border: 3px solid #fff; border-left:0; }
        .box-right { position: absolute; right: 0; top: 137px; width: 140px; height: 275px; border: 3px solid #fff; border-right:0; }
        
        /* OYUNCU */
        .player {
            position: absolute; width: 75px; padding: 5px; border-radius: 6px;
            text-align: center; font-weight: 800; font-size: 10px;
            cursor: grab; z-index: 20; transform: translate(-50%, -50%);
            transition: left 0.3s ease-out, top 0.3s ease-out; box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }
        .team-a { background: #e11d48; border: 2px solid #fff; color: white; }
        .team-b { background: #2563eb; border: 2px solid #fff; color: white; }
        .vest-on { background: #fbbf24 !important; color: #000 !important; border: 2px dashed #000 !important; }

        #field-wrapper { display: flex; justify-content: center; align-items: center; height: 100vh; width: 100vw; }
    </style>
</head>
<body>

<div id="field-wrapper">
    <div id="field" class="field rounded-sm shadow-2xl">
        <div class="absolute left-1/2 top-0 w-0.5 h-full bg-white/50"></div>
        <div class="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-32 h-32 border-2 border-white/50 rounded-full"></div>
        <div class="box-left"></div><div class="box-right"></div>
        <div id="ball" class="absolute w-10 h-10 bg-white rounded-full flex items-center justify-center cursor-grab z-[100] text-xl transform -translate-x-1/2 -translate-y-1/2" style="left:50%; top:50%">‚öΩ</div>
    </div>
</div>

<div class="draggable-menu w-[400px]" style="top: 20px; left: 20px;">
    <div class="menu-header">
        <span class="text-[10px] font-black">‚öôÔ∏è ANA KONTROLLER</span>
        <div class="w-3 h-3 bg-emerald-500 rounded-full"></div>
    </div>
    <div class="p-4 space-y-4">
        <div class="flex justify-between items-center gap-4">
            <select id="playerCount" onchange="updatePlayerList()" class="bg-slate-800 text-xs p-2 rounded-lg flex-1 border border-slate-700"></select>
            <button onclick="exportImage()" class="bg-slate-700 p-2 rounded-lg">üì∏</button>
        </div>
        <div class="flex gap-2">
            <button onclick="distributeAndAlign()" class="bg-emerald-600 px-4 py-2 rounded-xl font-bold text-[10px] flex-1 uppercase">Diz</button>
            <button onclick="randomVest()" class="bg-amber-500 text-black px-4 py-2 rounded-xl font-bold text-[10px] flex-1 uppercase">Yelek</button>
        </div>
    </div>
</div>

<div class="draggable-menu w-[300px]" style="top: 20px; right: 20px;">
    <div class="menu-header">
        <span class="text-[10px] font-black">üèÉ OYUNCU AYARLARI</span>
        <div class="w-3 h-3 bg-blue-500 rounded-full"></div>
    </div>
    <div id="playerInputs" class="p-3 max-h-[400px] overflow-y-auto space-y-2"></div>
</div>

<div class="draggable-menu w-[220px]" style="bottom: 40px; left: 20px;">
    <div class="menu-header">
        <span class="text-rose-500 text-[10px] font-black">TEAM A</span>
    </div>
    <div class="p-4 space-y-4">
        <select id="tacticA" onchange="realignOnly('a')" class="w-full bg-slate-800 p-2 rounded text-xs">
            <option value="3-1-2">3-1-2</option><option value="2-2-2">2-2-2</option><option value="3-2-1">3-2-1</option>
        </select>
        <input type="range" oninput="moveLine('a', 'DEF', this.value)" min="-100" max="100" value="0" class="w-full accent-rose-500">
        <input type="range" oninput="moveLine('a', 'MID', this.value)" min="-100" max="100" value="0" class="w-full accent-rose-500">
    </div>
</div>

<div class="draggable-menu w-[220px]" style="bottom: 40px; right: 20px;">
    <div class="menu-header">
        <span class="text-blue-500 text-[10px] font-black">TEAM B</span>
    </div>
    <div class="p-4 space-y-4">
        <select id="tacticB" onchange="realignOnly('b')" class="w-full bg-slate-800 p-2 rounded text-xs">
            <option value="3-1-2">3-1-2</option><option value="2-2-2">2-2-2</option><option value="3-2-1">3-2-1</option>
        </select>
        <input type="range" oninput="moveLine('b', 'DEF', this.value)" min="-100" max="100" value="0" class="w-full accent-blue-500">
        <input type="range" oninput="moveLine('b', 'MID', this.value)" min="-100" max="100" value="0" class="w-full accent-blue-500">
    </div>
</div>

<script>
let players = [];
let activeDrag = null, startX, startY, initialX, initialY, dragType = "";
let topZ = 100;

const tacticData = {
    "3-1-2": { GK:[10,50], DEF:[[30,20],[30,50],[30,80]], MID:[[55,50]], FWD:[[85,30],[85,70]] },
    "2-2-2": { GK:[10,50], DEF:[[30,30],[30,70]], MID:[[55,30],[55,70]], FWD:[[85,30],[85,70]] },
    "3-2-1": { GK:[10,50], DEF:[[30,20],[30,50],[30,80]], MID:[[62,30],[62,70]], FWD:[[88,50]] }
};

// HER ≈ûEYƒ∞ S√úR√úKLENEBƒ∞Lƒ∞R YAPMA FONKSƒ∞YONU
function initDraggable(el, header) {
    header.onmousedown = (e) => {
        activeDrag = el;
        dragType = "menu";
        startX = e.clientX; startY = e.clientY;
        initialX = el.offsetLeft; initialY = el.offsetTop;
        el.style.zIndex = ++topZ;
    };
}

function init() {
    const sel = document.getElementById('playerCount');
    for(let i=2; i<=22; i+=2) {
        let opt = document.createElement('option'); opt.value = i; opt.innerText = `${i} Oyuncu`;
        if(i===12) opt.selected = true; sel.appendChild(opt);
    }
    updatePlayerList();
    
    // Men√ºleri Tanƒ±mla
    document.querySelectorAll('.draggable-menu').forEach(menu => {
        initDraggable(menu, menu.querySelector('.menu-header'));
    });
}

function updatePlayerList() {
    const count = parseInt(document.getElementById('playerCount').value);
    players = Array.from({length: count}, (_, i) => players[i] || { id: i, name: `Oyu ${i + 1}`, quality: 5, positions: i < 2 ? ["GK"] : ["MID"] });
    const container = document.getElementById('playerInputs');
    container.innerHTML = players.map((p, i) => `
        <div class="bg-slate-800/50 p-2 rounded-lg border border-slate-700 flex flex-col gap-1">
            <input type="text" value="${p.name}" oninput="players[${i}].name=this.value" class="bg-slate-900 p-1 text-[10px] rounded font-bold outline-none">
            <div class="flex gap-1">
                ${["GK","DEF","MID","FWD"].map(pos => `
                    <button onclick="togglePos(${i},'${pos}',this)" class="flex-1 text-[7px] p-1 rounded ${p.positions.includes(pos) ? 'bg-emerald-600' : 'bg-slate-700'}">${pos}</button>
                `).join('')}
            </div>
        </div>
    `).join('');
}

function togglePos(idx, pos, btn) {
    let p = players[idx];
    p.positions.includes(pos) ? p.positions = p.positions.filter(x => x !== pos) : p.positions.push(pos);
    updatePlayerList();
}

function distributeAndAlign() {
    const count = parseInt(document.getElementById('playerCount').value);
    let pool = [...players].sort(() => Math.random() - 0.5);
    let teamA = [], teamB = [];
    
    pool.sort((a,b) => b.quality - a.quality).forEach(p => {
        (teamA.length < count/2) ? teamA.push(p) : teamB.push(p);
    });
    
    document.querySelectorAll('.player:not(#ball)').forEach(e => e.remove());
    alignTeam(teamA, 'a', document.getElementById('tacticA').value);
    alignTeam(teamB, 'b', document.getElementById('tacticB').value);
}

function alignTeam(teamArr, teamName, tacKey) {
    const tac = tacticData[tacKey];
    let slots = [{role:'GK', pos:tac.GK}, ...tac.DEF.map(p=>({role:'DEF',pos:p})), ...tac.MID.map(p=>({role:'MID',pos:p})), ...tac.FWD.map(p=>({role:'FWD',pos:p}))];
    teamArr.forEach((p, i) => {
        if(!slots[i]) return;
        const el = document.createElement('div');
        el.className = `player team-${teamName}`;
        el.innerHTML = `<div>${p.name}</div><div class="text-[7px] opacity-50">${slots[i].role}</div>`;
        el.dataset.role = slots[i].role; el.dataset.team = teamName;
        let [rx, ry] = slots[i].pos;
        let fx = teamName === 'a' ? rx/2 : 100 - rx/2;
        el.style.left = fx + "%"; el.style.top = ry + "%"; el.dataset.baseX = fx;
        makePlayerDraggable(el);
        document.getElementById('field').appendChild(el);
    });
}

function makePlayerDraggable(el) {
    el.onmousedown = (e) => {
        e.stopPropagation();
        activeDrag = el; dragType = "player";
        startX = e.clientX; startY = e.clientY;
        initialX = el.offsetLeft; initialY = el.offsetTop;
        el.style.transition = "none";
        el.style.zIndex = ++topZ;
    };
}

window.onmousemove = (e) => {
    if(!activeDrag) return;
    let dx = e.clientX - startX;
    let dy = e.clientY - startY;
    activeDrag.style.left = (initialX + dx) + "px";
    activeDrag.style.top = (initialY + dy) + "px";
};

window.onmouseup = () => {
    if(activeDrag && dragType === "player") activeDrag.style.transition = "left 0.3s ease-out, top 0.3s ease-out";
    activeDrag = null;
};

function moveLine(team, role, val) {
    document.querySelectorAll('.player').forEach(el => {
        if(el.dataset.team === team && el.dataset.role === role) {
            let base = parseFloat(el.dataset.baseX);
            el.style.left = `calc(${base}% + ${val}px)`;
        }
    });
}

function randomVest() {
    const chosen = ['a', 'b'][Math.floor(Math.random() * 2)];
    document.querySelectorAll('.player').forEach(p => {
        p.classList.remove('vest-on');
        if(p.classList.contains(`team-${chosen}`)) p.classList.add('vest-on');
    });
}

function exportImage() {
    html2canvas(document.getElementById('field')).then(canvas => {
        const link = document.createElement('a');
        link.download = 'taktik_freedom.png';
        link.href = canvas.toDataURL();
        link.click();
    });
}

makePlayerDraggable(document.getElementById('ball'));
init();
</script>
</body>
</html>
