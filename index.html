<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HalÄ± Saha Taktik TahtasÄ±</title>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .field {
      position: relative;
      width: 100%;
      max-width: 800px;
      height: 500px;
      background-color: #15803d; /* YeÅŸil saha rengi */
      border: 4px solid white;
      border-radius: 8px;
      margin: 20px auto;
      overflow: hidden;
      touch-action: none; /* Mobil kaydÄ±rmayÄ± engeller, sadece sÃ¼rÃ¼klemeye odaklanÄ±r */
    }
    .line { position: absolute; background: white; }
    .center-line { top: 0; left: 50%; width: 2px; height: 100%; transform: translateX(-50%); }
    .center-circle { top: 50%; left: 50%; width: 90px; height: 90px; border: 2px solid white; border-radius: 50%; transform: translate(-50%, -50%); }
    .goal { position: absolute; width: 12px; height: 120px; border: 2px solid white; top: 50%; transform: translateY(-50%); background: rgba(255,255,255,0.2); }
    .penalty-area-a { position: absolute; left: 0; top: 50%; transform: translateY(-50%); width: 80px; height: 240px; border: 2px solid white; border-left: none; }
    .penalty-area-b { position: absolute; right: 0; top: 50%; transform: translateY(-50%); width: 80px; height: 240px; border: 2px solid white; border-right: none; }
    
    .player {
      position: absolute;
      padding: 6px 12px;
      border-radius: 50px;
      font-weight: bold;
      color: black;
      cursor: grab;
      user-select: none;
      box-shadow: 0 4px 6px rgba(0,0,0,0.3);
      z-index: 10;
      transition: transform 0.1s;
      white-space: nowrap;
      border: 2px solid rgba(0,0,0,0.2);
    }
    .player:active { cursor: grabbing; transform: scale(1.1); z-index: 100; }
    
    .ball {
      position: absolute;
      width: 35px;
      height: 35px;
      background: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      cursor: grab;
      z-index: 50;
      box-shadow: 0 4px 8px rgba(0,0,0,0.5);
    }
  </style>
</head>
<body class="bg-slate-900 text-white font-sans">

<header class="bg-slate-800 text-center text-2xl font-black py-6 shadow-2xl border-b-4 border-yellow-500">
  âš½ HALI SAHA TAKTÄ°K TAHTASI
</header>

<div class="container mx-auto p-4">
  <div class="bg-slate-800 p-6 rounded-xl mb-6 border border-slate-700 shadow-lg">
    <div class="flex flex-wrap gap-4 items-center justify-between">
      <div class="flex items-center gap-3">
        <label class="font-bold">KiÅŸi SayÄ±sÄ±:</label>
        <select id="playerCount" class="bg-slate-700 text-white p-2 rounded-lg outline-none border border-slate-600 w-20"></select>
        <button onclick="generatePlayers()" class="bg-yellow-500 hover:bg-yellow-400 text-slate-900 px-6 py-2 rounded-lg font-black transition-all">LÄ°STEYÄ° OLUÅžTUR</button>
      </div>
      <button onclick="clearCache()" class="bg-red-500 hover:bg-red-400 px-4 py-2 rounded-lg font-bold transition-all text-sm">VERÄ°LERÄ° SIFIRLA</button>
    </div>
  </div>

  <div id="players" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 mb-6"></div>

  <div class="bg-slate-800 p-6 rounded-xl mb-6 border border-slate-700 shadow-lg">
    <div class="flex flex-col md:flex-row justify-between items-center gap-6">
      <div class="flex gap-6 items-center">
        <label class="flex items-center gap-2 cursor-pointer bg-slate-700 px-4 py-2 rounded-full border border-slate-600">
          <input type="radio" name="mode" value="one" checked class="accent-yellow-500"> Tek TakÄ±m
        </label>
        <label class="flex items-center gap-2 cursor-pointer bg-slate-700 px-4 py-2 rounded-full border border-slate-600">
          <input type="radio" name="mode" value="two" class="accent-yellow-500"> Ã‡ift TakÄ±m
        </label>
      </div>
      
      <div class="flex flex-wrap gap-3">
        <button onclick="createTeams()" class="bg-green-500 hover:bg-green-400 text-white px-8 py-3 rounded-full font-black shadow-lg transform hover:-translate-y-1 transition-all">SAHAYA DÄ°Z</button>
        <button onclick="toggleVest()" class="bg-blue-600 hover:bg-blue-500 text-white px-6 py-3 rounded-full font-bold transition-all">ðŸ¦º RENK DEÄžÄ°ÅžTÄ°R</button>
        <button onclick="shareImage()" class="bg-indigo-600 hover:bg-indigo-500 text-white px-6 py-3 rounded-full font-bold transition-all">ðŸ“¸ RESMÄ° KAYDET</button>
      </div>

      <div class="flex gap-4 p-2 bg-slate-900 rounded-lg">
        <div class="text-center"><p class="text-xs mb-1">TakÄ±m A</p><input type="color" id="colorA" value="#fbbf24" class="h-10 w-10 cursor-pointer rounded"></div>
        <div class="text-center"><p class="text-xs mb-1">TakÄ±m B</p><input type="color" id="colorB" value="#22d3ee" class="h-10 w-10 cursor-pointer rounded"></div>
      </div>
    </div>
  </div>

  <div id="teams"></div>
</div>

<script>
let players = [];
const playersDiv = document.getElementById('players');
const teamsDiv = document.getElementById('teams');

document.addEventListener('DOMContentLoaded', () => {
  const select = document.getElementById('playerCount');
  for (let i = 2; i <= 22; i++) {
    const opt = document.createElement('option');
    opt.value = i; opt.textContent = i;
    if(i === 12) opt.selected = true;
    select.appendChild(opt);
  }
  if (localStorage.getItem('players')) {
    players = JSON.parse(localStorage.getItem('players'));
    renderPlayers();
  }
});

function save() { localStorage.setItem('players', JSON.stringify(players)); }

function generatePlayers() {
  const count = Number(document.getElementById('playerCount').value);
  players = [];
  for (let i = 1; i <= count; i++) {
    players.push({ name: `Oyuncu ${i}`, power: 3, pos: 'MID' });
  }
  save();
  renderPlayers();
}

function renderPlayers() {
  playersDiv.innerHTML = '';
  players.forEach((p, i) => {
    const div = document.createElement('div');
    div.className = 'bg-slate-700 p-3 rounded-lg flex items-center gap-3 border border-slate-600 shadow-md hover:border-yellow-500 transition-colors';
    div.innerHTML = `
      <input value="${p.name}" onchange="players[${i}].name=this.value;save()" class="bg-slate-800 text-white p-2 rounded border border-slate-600 w-full focus:ring-1 focus:ring-yellow-500 outline-none">
      <div class="flex gap-1 bg-slate-900 p-1 rounded-lg">
        ${['GK','DEF','MID','FWD'].map(pos => `
          <button onclick="setPos(${i},'${pos}')" class="text-[10px] w-8 h-8 rounded ${p.pos==pos?'bg-yellow-500 text-slate-900 font-bold':'bg-slate-700 text-slate-400'}">${pos}</button>
        `).join('')}
      </div>
    `;
    playersDiv.appendChild(div);
  });
}

function setPos(idx, pos) {
  players[idx].pos = pos;
  save();
  renderPlayers();
}

function createTeams() {
  if (players.length === 0) return alert("Ã–nce oyuncularÄ± ekleyin kanka!");
  const mode = document.querySelector('input[name="mode"]:checked').value;
  let teamA = [], teamB = [];

  if (mode === 'one') {
    teamA = [...players];
  } else {
    // Rastgele deÄŸil, sÄ±rayla daÄŸÄ±tarak denge saÄŸlÄ±yoruz
    players.forEach((p, idx) => {
      if (idx % 2 === 0) teamA.push(p);
      else teamB.push(p);
    });
  }
  drawField(teamA, teamB);
}

function drawField(teamA, teamB) {
  teamsDiv.innerHTML = '';
  const field = document.createElement('div');
  field.className = 'field shadow-2xl';
  field.id = "tacticalField";
  
  field.innerHTML = `
    <div class="center-line"></div>
    <div class="center-circle"></div>
    <div class="penalty-area-a"></div>
    <div class="penalty-area-b"></div>
    <div class="goal" style="left:-6px;"></div>
    <div class="goal" style="right:-6px;"></div>
  `;

  // Top
  const ball = document.createElement('div');
  ball.className = 'ball';
  ball.innerHTML = 'âš½';
  ball.style.top = '232px'; ball.style.left = '382px';
  makeDraggable(ball);
  field.appendChild(ball);

  const yBase = { GK: 220, DEF: 80, MID: 220, FWD: 360 };

  // TakÄ±m A (Sol)
  teamA.forEach((p, i) => {
    const el = createPlayerEl(p, document.getElementById('colorA').value);
    const xBase = { GK: 40, DEF: 140, MID: 240, FWD: 340 };
    el.style.left = (xBase[p.pos] || 200) + 'px';
    el.style.top = (yBase[p.pos] + (i * 10)) + 'px';
    makeDraggable(el);
    field.appendChild(el);
  });

  // TakÄ±m B (SaÄŸ)
  if (teamB.length > 0) {
    teamB.forEach((p, i) => {
      const el = createPlayerEl(p, document.getElementById('colorB').value);
      const xBase = { GK: 700, DEF: 600, MID: 500, FWD: 400 };
      el.style.left = (xBase[p.pos] || 500) + 'px';
      el.style.top = (yBase[p.pos] + (i * 10)) + 'px';
      makeDraggable(el);
      field.appendChild(el);
    });
  }

  teamsDiv.appendChild(field);
}

function createPlayerEl(p, color) {
  const div = document.createElement('div');
  div.className = 'player';
  div.textContent = p.name;
  div.style.backgroundColor = color;
  return div;
}

function makeDraggable(el) {
  let isDragging = false;
  let startX, startY, initialX, initialY;

  const onStart = (e) => {
    isDragging = true;
    const clientX = e.type === 'touchstart' ? e.touches[0].clientX : e.clientX;
    const clientY = e.type === 'touchstart' ? e.touches[0].clientY : e.clientY;
    
    startX = clientX - el.offsetLeft;
    startY = clientY - el.offsetTop;
    el.style.transition = "none";
  };

  const onMove = (e) => {
    if (!isDragging) return;
    e.preventDefault();
    const clientX = e.type === 'touchmove' ? e.touches[0].clientX : e.clientX;
    const clientY = e.type === 'touchmove' ? e.touches[0].clientY : e.clientY;

    const parent = el.parentElement;
    let newX = clientX - startX;
    let newY = clientY - startY;

    // Saha dÄ±ÅŸÄ±na Ã§Ä±kma engeli
    newX = Math.max(0, Math.min(newX, parent.clientWidth - el.offsetWidth));
    newY = Math.max(0, Math.min(newY, parent.clientHeight - el.offsetHeight));

    el.style.left = newX + 'px';
    el.style.top = newY + 'px';
  };

  const onEnd = () => {
    isDragging = false;
  };

  el.addEventListener('mousedown', onStart);
  document.addEventListener('mousemove', onMove);
  document.addEventListener('mouseup', onEnd);

  el.addEventListener('touchstart', onStart, { passive: false });
  document.addEventListener('touchmove', onMove, { passive: false });
  document.addEventListener('touchend', onEnd);
}

function toggleVest() {
  const a = document.getElementById('colorA');
  const b = document.getElementById('colorB');
  [a.value, b.value] = [b.value, a.value];
  createTeams();
}

function shareImage() {
  const field = document.getElementById('tacticalField');
  if (!field) return alert("Ã–nce sahayÄ± oluÅŸtur kanka!");
  html2canvas(field).then(canvas => {
    const a = document.createElement('a');
    a.href = canvas.toDataURL("image/png");
    a.download = 'halisaha-taktik.png';
    a.click();
  });
}

function clearCache() {
  if(confirm("TÃ¼m veriler silinecek, emin misin?")) {
    localStorage.clear();
    location.reload();
  }
}
</script>
</body>
</html>
