<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mini HalÄ± Saha - Fix</title>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .field {
      position: relative;
      width: 100%;
      max-width: 800px;
      height: 450px;
      background-color: #065f46;
      border: 4px solid white;
      border-radius: 12px;
      margin: 20px auto;
      overflow: hidden;
    }
    .line { position: absolute; background:white; }
    .center-line { top:0; left:50%; width:2px; height:100%; transform:translateX(-50%); }
    .center-circle { top:50%; left:50%; width:80px; height:80px; border:2px solid white; border-radius:50%; transform:translate(-50%,-50%); }
    .goal { position:absolute; width:10px; height:100px; background:white; top:50%; transform:translateY(-50%); opacity: 0.8; }
    .player, .ball { position:absolute; padding:4px 10px; border-radius:20px; text-align:center; cursor:grab; user-select:none; font-weight: bold; border: 1px solid rgba(0,0,0,0.3); white-space: nowrap;}
    .ball { width:30px; height:30px; background:white; display:flex; align-items:center; justify-content:center; border-radius: 50%;}
  </style>
</head>
<body class="bg-green-900 text-white font-sans">

<header class="bg-green-700 text-center text-xl font-bold py-4 shadow-lg">âš½ Ä°nteraktif Mini HalÄ± Saha Pro</header>

<div class="container mx-auto p-4">
  <div class="bg-green-800 p-4 rounded-lg mb-4 flex gap-4 items-center">
    <label>Oyuncu SayÄ±sÄ±:</label>
    <select id="playerCount" class="text-black p-1 rounded"></select>
    <button onclick="generatePlayers()" class="bg-yellow-500 text-black px-4 py-1 rounded font-bold hover:bg-yellow-400">OyuncularÄ± Listele</button>
    <button onclick="clearCache()" class="bg-red-600 px-4 py-1 rounded font-bold hover:bg-red-500">SÄ±fÄ±rla</button>
  </div>

  <div id="players" class="grid grid-cols-1 md:grid-cols-2 gap-2 mb-4"></div>

  <div class="bg-green-800 p-4 rounded-lg mb-4">
    <div class="mb-4">
      <label class="mr-6 cursor-pointer"><input type="radio" name="mode" value="one" checked> Tek TakÄ±m (Antrenman)</label>
      <label class="cursor-pointer"><input type="radio" name="mode" value="two"> Ä°ki TakÄ±m (MaÃ§)</label>
    </div>

    <div class="flex flex-wrap gap-4 items-center">
      <button onclick="createTeams()" class="bg-yellow-500 text-black px-6 py-2 rounded-full font-bold shadow-lg">ğŸŸï¸ TakÄ±mlarÄ± Sahaya Diz</button>
      <button onclick="toggleVest()" class="bg-blue-500 px-4 py-2 rounded-full font-bold">ğŸ¦º Renkleri DeÄŸiÅŸtir</button>
      <button onclick="shareImage()" class="bg-green-500 px-4 py-2 rounded-full font-bold">ğŸ“¸ Resmi Ä°ndir</button>
      <div class="flex gap-4 border-l pl-4 border-green-600">
        <label>A: <input type="color" id="colorA" value="#ffc107" class="rounded cursor-pointer"></label>
        <label>B: <input type="color" id="colorB" value="#0dcaf0" class="rounded cursor-pointer"></label>
      </div>
    </div>
  </div>

  <div id="teams"></div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const playerCountSelect = document.getElementById('playerCount');
  for (let i = 2; i <= 22; i++) {
    const option = document.createElement('option');
    option.value = i; option.textContent = i;
    if(i === 12) option.selected = true;
    playerCountSelect.appendChild(option);
  }

  if (localStorage.getItem('players')) {
    players = JSON.parse(localStorage.getItem('players'));
    renderPlayers();
  }
});

let players = [];
const playersDiv = document.getElementById('players');
const teamsDiv = document.getElementById('teams');

function save() { localStorage.setItem('players', JSON.stringify(players)); }

function generatePlayers() {
  const c = Number(document.getElementById('playerCount').value);
  players = [];
  for (let i = 1; i <= c; i++) {
    players.push({ name: `Oyuncu ${i}`, power: 3, pos: ['MID'] });
  }
  save();
  renderPlayers();
}

function renderPlayers() {
  playersDiv.innerHTML = '';
  players.forEach((p, i) => {
    const div = document.createElement('div');
    div.className = 'bg-green-700 p-3 rounded-lg flex items-center gap-3 shadow-inner';
    div.innerHTML = `
      <input value="${p.name}" onchange="players[${i}].name=this.value;save()" class="text-black p-1 rounded w-32">
      <select onchange="players[${i}].power=Number(this.value);save()" class="text-black p-1 rounded">
        ${[1,2,3,4,5].map(v => `<option value="${v}" ${p.power==v?'selected':''}>â­ ${v}</option>`).join('')}
      </select>
      <div class="text-xs flex gap-1">
        <button onclick="setPos(${i},'GK')" class="bg-gray-800 p-1 rounded ${p.pos[0]=='GK'?'ring-2 ring-yellow-400':''}">KL</button>
        <button onclick="setPos(${i},'DEF')" class="bg-gray-800 p-1 rounded ${p.pos[0]=='DEF'?'ring-2 ring-yellow-400':''}">DF</button>
        <button onclick="setPos(${i},'MID')" class="bg-gray-800 p-1 rounded ${p.pos[0]=='MID'?'ring-2 ring-yellow-400':''}">OS</button>
        <button onclick="setPos(${i},'FWD')" class="bg-gray-800 p-1 rounded ${p.pos[0]=='FWD'?'ring-2 ring-yellow-400':''}">FV</button>
      </div>
    `;
    playersDiv.appendChild(div);
  });
}

function setPos(idx, pos) {
  players[idx].pos = [pos];
  save();
  renderPlayers();
}

function createTeams() {
  if (players.length === 0) return alert("Ã–nce oyuncularÄ± oluÅŸturun.");
  const mode = document.querySelector('input[name="mode"]:checked').value;
  const list = [...players].sort((a, b) => b.power - a.power);

  let teamA = [], teamB = [], powerA = 0, powerB = 0;

  if (mode === 'one') {
    teamA = list;
    teamB = null;
  } else {
    // YÄ±lan tipi daÄŸÄ±tÄ±mÄ± (Snaking) ile gÃ¼Ã§ dengesi saÄŸla
    list.forEach((p, index) => {
      if (index % 2 === 0) { teamA.push(p); } 
      else { teamB.push(p); }
    });
  }

  drawField(teamA, teamB);
}

function drawField(teamA, teamB) {
  teamsDiv.innerHTML = '';
  const field = document.createElement('div');
  field.className = 'field';
  
  field.innerHTML = `
    <div class="center-line"></div>
    <div class="center-circle"></div>
    <div class="goal" style="left:0; border-right: 2px solid white;"></div>
    <div class="goal" style="right:0; border-left: 2px solid white;"></div>
  `;

  const ball = document.createElement('div');
  ball.className = 'ball';
  ball.innerHTML = 'âš½';
  ball.style.top = '210px'; ball.style.left = '385px';
  makeDraggable(ball);
  field.appendChild(ball);

  const yPositions = { GK: 200, DEF: 80, MID: 210, FWD: 340 };

  // Team A yerleÅŸtirme (Sol Taraf)
  teamA.forEach((p, i) => {
    const el = createPlayerEl(p, document.getElementById('colorA').value);
    el.style.left = (p.pos[0] === 'GK' ? 30 : p.pos[0] === 'DEF' ? 120 : p.pos[0] === 'MID' ? 220 : 320) + 'px';
    el.style.top = (yPositions[p.pos[0]] + (i * 5)) + 'px';
    makeDraggable(el);
    field.appendChild(el);
  });

  // Team B yerleÅŸtirme (SaÄŸ Taraf)
  if (teamB) {
    teamB.forEach((p, i) => {
      const el = createPlayerEl(p, document.getElementById('colorB').value);
      // SaÄŸ taraf iÃ§in X eksenini ters Ã§eviriyoruz
      el.style.left = (p.pos[0] === 'GK' ? 730 : p.pos[0] === 'DEF' ? 630 : p.pos[0] === 'MID' ? 530 : 430) + 'px';
      el.style.top = (yPositions[p.pos[0]] + (i * 5)) + 'px';
      makeDraggable(el);
      field.appendChild(el);
    });
  }

  teamsDiv.appendChild(field);
}

function createPlayerEl(p, color) {
  const div = document.createElement('div');
  div.className = 'player text-black';
  div.textContent = p.name;
  div.style.backgroundColor = color;
  return div;
}

function makeDraggable(el) {
  el.onmousedown = function(e) {
    const field = el.parentElement;
    let shiftX = e.clientX - el.getBoundingClientRect().left;
    let shiftY = e.clientY - el.getBoundingClientRect().top;

    function moveAt(pageX, pageY) {
      let x = pageX - shiftX - field.getBoundingClientRect().left;
      let y = pageY - shiftY - field.getBoundingClientRect().top;
      el.style.left = Math.max(0, Math.min(field.clientWidth - el.offsetWidth, x)) + 'px';
      el.style.top = Math.max(0, Math.min(field.clientHeight - el.offsetHeight, y)) + 'px';
    }

    function onMouseMove(e) { moveAt(e.pageX, e.pageY); }
    document.addEventListener('mousemove', onMouseMove);
    document.onmouseup = function() {
      document.removeEventListener('mousemove', onMouseMove);
      document.onmouseup = null;
    };
  };
  el.ondragstart = () => false;
}

function toggleVest() {
  const cA = document.getElementById('colorA');
  const cB = document.getElementById('colorB');
  const temp = cA.value;
  cA.value = cB.value;
  cB.value = temp;
  createTeams();
}

function shareImage() {
  html2canvas(document.querySelector(".field")).then(canvas => {
    const link = document.createElement('a');
    link.download = 'kadro.png';
    link.href = canvas.toDataURL();
    link.click();
  });
}

function clearCache() {
  localStorage.clear();
  location.reload();
}
</script>
</body>
</html>
