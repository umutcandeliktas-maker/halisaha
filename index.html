<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Taktik Pro v15.1 FINAL</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>
body{background:#020617;color:white}

/* SAHA */
.field{
width:1100px;height:650px;margin:auto;position:relative;
background:radial-gradient(circle,#0a5c2a,#032b13);
border:5px solid #fff;border-radius:15px;
box-shadow:0 0 40px rgba(0,0,0,.6)
}
.line{position:absolute;background:rgba(255,255,255,.8)}
.mid-line{left:50%;top:0;width:2px;height:100%;transform:translateX(-50%)}
.center-circle{
width:140px;height:140px;border:2px solid #fff;border-radius:50%;
left:50%;top:50%;position:absolute;transform:translate(-50%,-50%)
}
.goal{
position:absolute;width:20px;height:120px;border:2px solid #fff;top:50%;
transform:translateY(-50%)
}
.goal.left{left:-20px}
.goal.right{right:-20px}

/* OYUNCU */
.player{
position:absolute;width:120px;padding:8px;border-radius:12px;
transform:translate(-50%,-50%);
font-weight:bold;text-align:center;color:black;
cursor:grab;
transition:all .35s cubic-bezier(.25,1,.5,1)
}
.team-a{background:#f3a616}
.team-b{background:#43d1f0}
.vest{outline:4px dashed white;filter:brightness(.85)}
.player:active{cursor:grabbing}

/* TOP */
.ball{
position:absolute;width:40px;height:40px;border-radius:50%;
background:white;left:50%;top:50%;
transform:translate(-50%,-50%);
display:flex;align-items:center;justify-content:center;
cursor:grab
}
</style>
</head>

<body class="p-6">

<div class="flex flex-wrap gap-2 mb-4 items-end">
<select id="tA" class="bg-slate-800 p-2 rounded">
<option>3-1-2</option><option>2-2-2</option><option>3-2-1</option>
</select>
<select id="tB" class="bg-slate-800 p-2 rounded">
<option>3-1-2</option><option>2-2-2</option><option>3-2-1</option>
</select>

<button onclick="createTeams()" class="bg-blue-600 px-3 py-2 rounded">Takım Oluştur</button>
<button onclick="applyTactics()" class="bg-green-600 px-3 py-2 rounded">Sahaya Diz</button>
<button onclick="randomVest()" class="bg-yellow-500 px-3 py-2 rounded">Yelek Giy</button>
<button onclick="saveTactic()" class="bg-purple-600 px-3 py-2 rounded">Kaydet</button>
<button onclick="loadTactic()" class="bg-indigo-600 px-3 py-2 rounded">Yükle</button>
<button onclick="exportImage()" class="bg-pink-600 px-3 py-2 rounded">Resim Paylaş</button>
<button onclick="fullReset()" class="bg-red-600 px-3 py-2 rounded">Sıfırla</button>
</div>

<div id="pList" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-3 mb-6"></div>

<div id="canvas" class="field">
<div class="line mid-line"></div>
<div class="center-circle"></div>
<div class="goal left"></div>
<div class="goal right"></div>
<div id="ball" class="ball">⚽</div>
</div>

<script>
let players=[];

const POS_PRIORITY=["GK","DEF","MID","FWD"];

/* % bazlı slotlar */
const tacts={
"3-1-2":{
GK:[[7,50]],
DEF:[[18,20],[18,50],[18,80]],
MID:[[35,50]],
FWD:[[50,25],[50,75]]
},
"2-2-2":{
GK:[[7,50]],
DEF:[[18,30],[18,70]],
MID:[[32,25],[32,75]],
FWD:[[48,30],[48,70]]
},
"3-2-1":{
GK:[[7,50]],
DEF:[[18,20],[18,50],[18,80]],
MID:[[32,35],[32,65]],
FWD:[[48,50]]
}
};

function createTeams(){
players=[];
for(let i=0;i<14;i++){
players.push({
id:i,
name:`Oyuncu ${i+1}`,
team:i<7?"A":"B",
positions:[]
});
}
renderUI();
}

function renderUI(){
pList.innerHTML=players.map((p,i)=>`
<div class="bg-slate-900 p-2 rounded">
<input value="${p.name}"
oninput="players[${i}].name=this.value"
class="bg-slate-800 w-full text-xs p-1 rounded mb-1">
<div class="grid grid-cols-2 text-[9px]">
${POS_PRIORITY.map(pos=>`
<label>
<input type="checkbox"
${p.positions.includes(pos)?"checked":""}
onchange="togglePos(${i},'${pos}',this.checked)">
${pos}
</label>`).join("")}
</div>
<span class="text-[9px] ${p.team==="A"?"text-orange-400":"text-cyan-400"}">${p.team}</span>
</div>`).join("");
}

function togglePos(i,pos,c){
if(c && !players[i].positions.includes(pos)) players[i].positions.push(pos);
if(!c) players[i].positions=players[i].positions.filter(x=>x!==pos);
}

function applyTactics(){
if(!checkGK()) return;
document.querySelectorAll(".player").forEach(e=>e.remove());

["A","B"].forEach(team=>{
const form=team==="A"?tA.value:tB.value;
let slots=JSON.parse(JSON.stringify(tacts[form]));

players.filter(p=>p.team===team).forEach(p=>{
for(let r of POS_PRIORITY){
if(p.positions.includes(r) && slots[r].length){
const [x,y]=slots[r].shift();
placePlayer(p,x,y,team);
break;
}}
});
});
}

function placePlayer(p,xp,yp,team){
const el=document.createElement("div");
el.className=`player team-${team.toLowerCase()}`;
el.dataset.id=p.id;
el.innerHTML=`${p.name}<div class="text-xs">${p.positions[0]||""}</div>`;

let fx=team==="A"?xp:100-xp;
el.style.left=(fx/100*1100)+"px";
el.style.top=(yp/100*650)+"px";

makeDraggable(el);
el.ondblclick=()=>switchTeam(el);
canvas.appendChild(el);
}

function switchTeam(el){
const p=players.find(x=>x.id==el.dataset.id);
p.team=p.team==="A"?"B":"A";
el.classList.toggle("team-a");
el.classList.toggle("team-b");
renderUI();
}

function makeDraggable(el){
let a=false,sx,sy,ix,iy;
el.onmousedown=e=>{
a=true;sx=e.clientX;sy=e.clientY;
ix=el.offsetLeft;iy=el.offsetTop;
el.style.transition="none";el.style.zIndex=99;
};
window.onmousemove=e=>{
if(!a) return;
el.style.left=(ix+e.clientX-sx)+"px";
el.style.top=(iy+e.clientY-sy)+"px";
};
window.onmouseup=()=>{
a=false;el.style.transition="all .35s";el.style.zIndex=20;
};
}

function randomVest(){
document.querySelectorAll(".player").forEach(p=>p.classList.remove("vest"));
const team=Math.random()<0.5?"A":"B";
document.querySelectorAll(`.team-${team.toLowerCase()}`)
.forEach(p=>p.classList.add("vest"));
}

function checkGK(){
for(let t of ["A","B"]){
if(!players.some(p=>p.team===t && p.positions.includes("GK"))){
alert(t+" takımında kaleci yok");
return false;
}}
return true;
}

function saveTactic(){
localStorage.setItem("tacticData",JSON.stringify({players,tA:tA.value,tB:tB.value}));
alert("Kaydedildi");
}

function loadTactic(){
const d=localStorage.getItem("tacticData");
if(!d) return;
const data=JSON.parse(d);
players=data.players;
tA.value=data.tA;tB.value=data.tB;
renderUI();applyTactics();
}

function exportImage(){
html2canvas(canvas).then(c=>{
const a=document.createElement("a");
a.download="taktik.png";
a.href=c.toDataURL();
a.click();
});
}

function fullReset(){
players=[];
pList.innerHTML="";
document.querySelectorAll(".player").forEach(e=>e.remove());
localStorage.clear();
ball.style.left="50%";ball.style.top="50%";
}
</script>
</body>
</html>
