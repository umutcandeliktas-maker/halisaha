<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HalÄ±saha TakÄ±m Kurucu</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#1e7f43">

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>
body { margin:0; font-family:Arial; background:#0f5132; color:#fff; }
header { background:#1e7f43; padding:15px; text-align:center; font-size:20px; font-weight:bold; }
.container { max-width:900px; margin:auto; padding:10px; }
button { padding:10px 14px; margin:4px; border:none; border-radius:6px; background:#ffc107; font-weight:bold; cursor:pointer; }
input, select { padding:6px; border-radius:4px; border:none; margin:2px; }
.player { background:#198754; padding:8px; border-radius:6px; margin-bottom:6px; }
.field { background:#198754; border-radius:10px; padding:10px; margin:15px 0; }
.line { display:flex; justify-content:center; gap:8px; margin:10px 0; flex-wrap:wrap; }
.card {
  background:#fff; color:#000; padding:6px 8px;
  border-radius:6px; min-width:70px;
  text-align:center; font-size:13px;
  cursor:grab;
}
.card.dragging { opacity:.5; }
.name { font-weight:bold; }
.pos { font-size:12px; }
</style>
</head>

<body>

<header>âš½ HalÄ±saha TakÄ±m Kurucu</header>

<div class="container">

<input id="singlePlayerName" placeholder="Oyuncu Ä°smi">
<button onclick="addSinglePlayer()">Oyuncu Ekle</button>

<hr>
<div id="players"></div>

<hr>

<label><input type="radio" name="mode" value="one" checked> Tek takÄ±m</label>
<label><input type="radio" name="mode" value="two"> Ä°ki takÄ±m</label>

<br><br>

<button onclick="createTeams()">ğŸŸï¸ TakÄ±m OluÅŸtur</button>
<button onclick="toggleVest()">ğŸ¦º Yelek DeÄŸiÅŸtir</button>
<button onclick="shareImage()">ğŸ“¸ Resim Ä°ndir</button>
<button onclick="clearCache()">ğŸ§¹ Temizle</button>

<div style="margin:10px 0;">
  <label>A Renk <input type="color" id="colorA" value="#ffc107"></label>
  <label>B Renk <input type="color" id="colorB" value="#0dcaf0"></label>
</div>

<div id="teams"></div>

</div>

<script>
let players = JSON.parse(localStorage.getItem('players')) || [];
let vestTeam = 1;

function save(){ localStorage.setItem('players', JSON.stringify(players)); }

function renderPlayers(){
  playersDiv.innerHTML='';
  players.forEach((p,i)=>{
    playersDiv.innerHTML+=`
    <div class="player">
      <input value="${p.name}" onchange="players[${i}].name=this.value;save()">
      <select onchange="players[${i}].power=this.value;save()">
        ${[1,2,3,4,5].map(n=>`<option ${p.power==n?'selected':''}>${n}</option>`).join('')}
      </select>
      <button onclick="removePlayer(${i})">âŒ</button>
    </div>`;
  });
}

function addSinglePlayer(){
  let n=singlePlayerName.value.trim();
  if(!n) n=`Oyuncu ${players.length+1}`;
  players.push({name:n,power:3});
  save(); renderPlayers(); singlePlayerName.value='';
}

function removePlayer(i){ players.splice(i,1); save(); renderPlayers(); }

function toggleVest(){ vestTeam=vestTeam===1?2:1; createTeams(); }

/* ğŸ”¥ DAHA DENGELÄ° ALGORÄ°TMA */
function balancedSplit(list){
  let a=[],b=[],pa=0,pb=0;
  list.forEach(p=>{
    if(pa<=pb){ a.push(p); pa+=+p.power; }
    else{ b.push(p); pb+=+p.power; }
  });
  return [a,b];
}

function createTeams(){
  const mode=document.querySelector('input[name="mode"]:checked').value;
  const list=[...players].sort((a,b)=>b.power-a.power);
  if(mode==='one'){
    teams.innerHTML=teamHTML('Bizim TakÄ±m',list,false,colorA.value);
    enableDrag();
    return;
  }
  const [a,b]=balancedSplit(list);
  teams.innerHTML=
    teamHTML('TakÄ±m A',a,vestTeam===1,colorA.value)+
    teamHTML('TakÄ±m B',b,vestTeam===2,colorB.value);
  enableDrag();
}

function teamHTML(title,team,vest,color){
  return `
  <h3>${vest?'ğŸ¦º ':''}${title}</h3>
  <div class="field" style="border:3px solid ${color}">
    <div class="line">
      ${team.map(p=>`
      <div class="card" draggable="true" style="border:2px solid ${color}">
        <div class="name">${p.name}</div>
        <div class="pos">â­ ${p.power}</div>
      </div>`).join('')}
    </div>
  </div>`;
}

/* ğŸ–±ï¸ SÃœRÃœKLE â€“ BIRAK */
function enableDrag(){
  document.querySelectorAll('.card').forEach(card=>{
    card.addEventListener('dragstart',()=>card.classList.add('dragging'));
    card.addEventListener('dragend',()=>card.classList.remove('dragging'));
  });
  document.querySelectorAll('.line').forEach(line=>{
    line.addEventListener('dragover',e=>{
      e.preventDefault();
      const dragging=document.querySelector('.dragging');
      if(dragging) line.appendChild(dragging);
    });
  });
}

/* ğŸ“¸ RESÄ°M Ä°NDÄ°R */
function shareImage(){
  const area=document.getElementById('teams');
  if(!area.innerHTML){ alert('Ã–nce takÄ±m oluÅŸtur'); return; }
  html2canvas(area).then(canvas=>{
    const a=document.createElement('a');
    a.href=canvas.toDataURL('image/png');
    a.download='halisaha-takimlar.png';
    a.click();
  });
}

function clearCache(){
  localStorage.clear(); players=[]; renderPlayers(); teams.innerHTML='';
}

const playersDiv=document.getElementById('players');
renderPlayers();
</script>

</body>
</html>
