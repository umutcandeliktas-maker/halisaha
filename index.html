<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Taktik Pro v15 FINAL</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>
body{background:#020617;color:white}
.field{
width:1100px;height:650px;margin:auto;position:relative;
background:radial-gradient(circle,#064d23,#021a0b);
border:5px solid white;border-radius:15px
}
.player{
position:absolute;width:120px;padding:8px;border-radius:12px;
transform:translate(-50%,-50%);
font-weight:bold;text-align:center;color:black;
cursor:grab;
transition:all .4s cubic-bezier(.25,1,.5,1)
}
.player:active{cursor:grabbing}
.team-a{background:#f3a616}
.team-b{background:#43d1f0}
.vest{outline:4px solid white;filter:brightness(.85)}
.ball{
position:absolute;width:40px;height:40px;border-radius:50%;
background:white;left:50%;top:50%;
transform:translate(-50%,-50%);
display:flex;align-items:center;justify-content:center;
cursor:grab
}
</style>
</head>

<body class="p-6">

<div class="flex flex-wrap gap-2 mb-4 items-end">
<select id="tA" class="bg-slate-800 p-2 rounded">
<option>3-1-2</option><option>2-2-2</option><option>3-2-1</option>
</select>
<select id="tB" class="bg-slate-800 p-2 rounded">
<option>3-1-2</option><option>2-2-2</option><option>3-2-1</option>
</select>

<button onclick="createTeams()" class="bg-blue-600 px-3 py-2 rounded">Takım Oluştur</button>
<button onclick="applyTactics()" class="bg-green-600 px-3 py-2 rounded">Sahaya Diz</button>
<button onclick="toggleVest()" class="bg-yellow-500 px-3 py-2 rounded">Yelek</button>
<button onclick="saveTactic()" class="bg-purple-600 px-3 py-2 rounded">Kaydet</button>
<button onclick="loadTactic()" class="bg-indigo-600 px-3 py-2 rounded">Yükle</button>
<button onclick="exportImage()" class="bg-pink-600 px-3 py-2 rounded">Resim Paylaş</button>
<button onclick="fullReset()" class="bg-red-600 px-3 py-2 rounded">Sıfırla</button>
</div>

<div id="pList" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-3 mb-6"></div>

<div id="canvas" class="field">
<div id="ball" class="ball">⚽</div>
</div>

<script>
let players=[],vestTurn="A";

const POS_PRIORITY=["GK","DEF","MID","FWD"];

const tacts={
"3-1-2":{
GK:[{x:7,y:50}],
DEF:[{x:18,y:20},{x:18,y:50},{x:18,y:80}],
MID:[{x:33,y:50}],
FWD:[{x:46,y:25},{x:46,y:75}]
},
"2-2-2":{
GK:[{x:7,y:50}],
DEF:[{x:18,y:30},{x:18,y:70}],
MID:[{x:32,y:25},{x:32,y:75}],
FWD:[{x:46,y:30},{x:46,y:70}]
},
"3-2-1":{
GK:[{x:7,y:50}],
DEF:[{x:18,y:20},{x:18,y:50},{x:18,y:80}],
MID:[{x:33,y:35},{x:33,y:65}],
FWD:[{x:46,y:50}]
}
};

function createTeams(){
players=[];
for(let i=0;i<14;i++){
players.push({
id:i,
name:`Oyuncu ${i+1}`,
team:i<7?"A":"B",
positions:[]
});
}
renderUI();
}

function renderUI(){
pList.innerHTML=players.map((p,i)=>`
<div class="bg-slate-900 p-2 rounded">
<input value="${p.name}"
oninput="players[${i}].name=this.value"
class="bg-slate-800 w-full text-xs p-1 rounded mb-1">
<div class="grid grid-cols-2 text-[9px]">
${POS_PRIORITY.map(pos=>`
<label>
<input type="checkbox"
${p.positions.includes(pos)?"checked":""}
onchange="togglePos(${i},'${pos}',this.checked)">
${pos}
</label>`).join("")}
</div>
<span class="text-[9px] ${p.team=="A"?"text-orange-400":"text-cyan-400"}">
${p.team} Takımı
</span>
</div>`).join("");
}

function togglePos(i,pos,c){
if(c && !players[i].positions.includes(pos))
players[i].positions.push(pos);
if(!c)
players[i].positions=players[i].positions.filter(x=>x!==pos);
}

function applyTactics(){
if(!checkGK()) return;
document.querySelectorAll(".player").forEach(e=>e.remove());

["A","B"].forEach(team=>{
const form=team=="A"?tA.value:tB.value;
let slots=JSON.parse(JSON.stringify(tacts[form]));

players.filter(p=>p.team==team).forEach(p=>{
for(let role of POS_PRIORITY){
if(p.positions.includes(role) && slots[role].length){
const c=slots[role].shift();
createPlayerEl(p,c,team);
break;
}}
});
});
}

function createPlayerEl(p,c,team){
const el=document.createElement("div");
el.className=`player team-${team.toLowerCase()}`;
el.dataset.id=p.id;
el.innerHTML=`${p.name}<div class="text-xs">${p.positions[0]||""}</div>`;

let x=team=="A"?c.x:100-c.x;
el.style.left=(x*11)+"px";
el.style.top=(c.y*6.5)+"px";

makeDraggable(el);
el.addEventListener("dblclick",()=>switchTeam(el));
canvas.appendChild(el);
}

function switchTeam(el){
const id=parseInt(el.dataset.id);
const p=players.find(x=>x.id===id);
p.team=p.team==="A"?"B":"A";
el.classList.toggle("team-a");
el.classList.toggle("team-b");
renderUI();
}

function makeDraggable(el){
let active=false,sx,sy,ix,iy;

el.addEventListener("mousedown",e=>{
active=true;
sx=e.clientX; sy=e.clientY;
ix=el.offsetLeft; iy=el.offsetTop;
el.style.transition="none";
el.style.zIndex=100;
});

window.addEventListener("mousemove",e=>{
if(!active) return;
el.style.left=(ix+e.clientX-sx)+"px";
el.style.top=(iy+e.clientY-sy)+"px";
});

window.addEventListener("mouseup",()=>{
active=false;
el.style.transition="all .4s cubic-bezier(.25,1,.5,1)";
el.style.zIndex=20;
});

/* Mobil */
el.addEventListener("touchstart",e=>{
active=true;
sx=e.touches[0].clientX;
sy=e.touches[0].clientY;
ix=el.offsetLeft;
iy=el.offsetTop;
el.style.transition="none";
},{passive:true});

window.addEventListener("touchmove",e=>{
if(!active) return;
el.style.left=(ix+e.touches[0].clientX-sx)+"px";
el.style.top=(iy+e.touches[0].clientY-sy)+"px";
},{passive:false});

window.addEventListener("touchend",()=>{
active=false;
el.style.transition="all .4s cubic-bezier(.25,1,.5,1)";
});
}

function checkGK(){
for(let t of ["A","B"]){
if(!players.some(p=>p.team==t && p.positions.includes("GK"))){
alert(t+" takımında kaleci yok");
return false;
}}
return true;
}

function toggleVest(){
document.querySelectorAll(`.team-${vestTurn.toLowerCase()}`)
.forEach(p=>p.classList.toggle("vest"));
vestTurn=vestTurn=="A"?"B":"A";
}

function saveTactic(){
localStorage.setItem("tacticData",JSON.stringify({
players,vestTurn,tA:tA.value,tB:tB.value
}));
alert("Taktik kaydedildi");
}

function loadTactic(){
const d=localStorage.getItem("tacticData");
if(!d) return alert("Kayıt yok");
const data=JSON.parse(d);
players=data.players;
vestTurn=data.vestTurn;
tA.value=data.tA;
tB.value=data.tB;
renderUI();
applyTactics();
}

function exportImage(){
html2canvas(canvas).then(c=>{
const a=document.createElement("a");
a.download="taktik.png";
a.href=c.toDataURL();
a.click();
});
}

function fullReset(){
players=[];
pList.innerHTML="";
document.querySelectorAll(".player").forEach(e=>e.remove());
localStorage.removeItem("tacticData");
ball.style.left="50%";ball.style.top="50%";
vestTurn="A";
}
</script>
</body>
</html>
