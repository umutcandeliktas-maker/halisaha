<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Halƒ± Saha Pro - Taktik Dizilim</title>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .field-container { position: relative; margin: 20px auto; width: fit-content; }
    .field {
      position: relative;
      width: 1000px;
      height: 600px;
      background-color: #1a8a42;
      border: 5px solid white;
      border-radius: 8px;
      overflow: hidden;
    }

    /* SAHA √áƒ∞ZGƒ∞LERƒ∞ */
    .center-line { position: absolute; top: 0; left: 50%; width: 2px; height: 100%; transform: translateX(-50%); background: rgba(255,255,255,0.8); }
    .center-circle { position: absolute; top: 50%; left: 50%; width: 120px; height: 120px; border: 2px solid white; border-radius: 50%; transform: translate(-50%, -50%); }
    .goal { position: absolute; width: 20px; height: 140px; border: 3px solid white; top: 50%; transform: translateY(-50%); background: rgba(255,255,255,0.1); }
    .penalty-area-a { position: absolute; left: 0; top: 50%; transform: translateY(-50%); width: 120px; height: 320px; border: 2px solid white; border-left: none; }
    .penalty-area-b { position: absolute; right: 0; top: 50%; transform: translateY(-50%); width: 120px; height: 320px; border: 2px solid white; border-right: none; }
    
    .player {
      position: absolute;
      width: 110px;
      padding: 10px 5px;
      border-radius: 20px;
      font-weight: bold;
      color: black;
      cursor: grab;
      z-index: 10;
      text-align: center;
      border: 2px solid rgba(0,0,0,0.15);
      user-select: none;
      font-size: 13px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.2);
      transform: translate(-50%, -50%); /* Tam merkezleme i√ßin */
    }
    .player.selected { outline: 4px solid #fff; box-shadow: 0 0 20px #fff; z-index: 50; }
    
    .ball {
      position: absolute;
      width: 35px;
      height: 35px;
      background: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 60;
      box-shadow: 0 4px 10px rgba(0,0,0,0.5);
      cursor: grab;
      font-size: 20px;
      transform: translate(-50%, -50%);
    }
  </style>
</head>
<body class="bg-slate-900 text-white font-sans">

<header class="bg-slate-800 text-center text-2xl font-black py-4 border-b-4 border-green-600 shadow-2xl">
  ‚öΩ PRO TAKTƒ∞K TAHTASI v8.1
</header>

<div class="container mx-auto p-4">
  <div class="bg-slate-800 p-4 rounded-xl mb-6 flex flex-wrap gap-4 items-center justify-between border border-slate-700">
    <div class="flex gap-4">
      <select id="playerCount" class="bg-slate-700 p-2 rounded-lg outline-none border border-slate-600"></select>
      <button onclick="generatePlayers()" class="bg-indigo-600 px-4 py-2 rounded-lg font-bold hover:bg-indigo-500">KADROYU SIFIRLA</button>
    </div>
    <div class="flex gap-3">
      <button onclick="createTeams()" class="bg-yellow-500 text-black px-10 py-3 rounded-full font-black shadow-lg hover:scale-105 transition-transform">üèüÔ∏è TAKIMLARI Dƒ∞Z</button>
      <button onclick="shareImage()" class="bg-green-600 px-6 py-3 rounded-full font-bold hover:bg-green-500">üì∏ G√ñRSELƒ∞ KAYDET</button>
    </div>
  </div>

  <div id="players" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8"></div>

  <div class="field-container">
    <div id="tacticalField" class="field">
      <div class="center-line"></div>
      <div class="center-circle"></div>
      <div class="penalty-area-a"></div>
      <div class="penalty-area-b"></div>
      <div class="goal" style="left:-8px;"></div>
      <div class="goal" style="right:-8px;"></div>
    </div>
  </div>
</div>

<script>
let players = [];
let selectedElements = [];
const STORAGE_KEY = 'halisaha_v8_final_fixed';

// G√∂rseldeki tam koordinatlar (Y√ºzde bazlƒ±)
const posMapA = { // Turuncu Takƒ±m (Sol)
  GK: { x: 5, y: 50 },
  DEF: [{x:16, y:50}, {x:18, y:20}, {x:18, y:80}], // Stoper, Bekler
  MID: [{x:30, y:35}, {x:30, y:65}], // Orta Sahalar
  FWD: { x: 40, y: 50 } // Forvet
};

const posMapB = { // Mavi Takƒ±m (Saƒü)
  GK: { x: 95, y: 50 },
  DEF: [{x:82, y:20}, {x:82, y:80}], // ƒ∞kili defans
  MID: [{x:70, y:35}, {x:70, y:65}, {x:88, y:50}], // Orta sahalar (biri g√∂m√ºl√º)
  FWD: { x: 60, y: 50 } // Forvet
};

document.addEventListener('DOMContentLoaded', () => {
  const select = document.getElementById('playerCount');
  for (let i = 2; i <= 22; i++) {
    const opt = document.createElement('option');
    opt.value = i; opt.textContent = i + " Oyuncu";
    if(i === 14) opt.selected = true;
    select.appendChild(opt);
  }
  if (localStorage.getItem(STORAGE_KEY)) {
    players = JSON.parse(localStorage.getItem(STORAGE_KEY));
  } else {
    generatePlayers();
  }
  renderPlayers();
});

function generatePlayers() {
  const count = Number(document.getElementById('playerCount').value);
  players = [];
  for (let i = 1; i <= count; i++) {
    players.push({ name: `Oyuncu ${i}`, power: 3, roles: [] });
  }
  save(); renderPlayers();
}

function renderPlayers() {
  const div = document.getElementById('players');
  div.innerHTML = '';
  players.forEach((p, i) => {
    const card = document.createElement('div');
    card.className = 'bg-slate-800 p-3 rounded-xl border border-slate-700 shadow-md';
    card.innerHTML = `
      <input value="${p.name}" onchange="players[${i}].name=this.value;save()" class="bg-slate-900 text-white p-2 rounded-lg w-full outline-none border border-slate-700 text-sm mb-2">
      <div class="flex gap-1">
        ${['GK','DEF','MID','FWD'].map(role => `
          <button onclick="toggleRole(${i},'${role}')" class="flex-1 text-[10px] py-2 rounded-md transition-all ${p.roles.includes(role)?'bg-indigo-600 text-white':'bg-slate-700 text-slate-400'}">${role}</button>
        `).join('')}
      </div>
    `;
    div.appendChild(card);
  });
}

function toggleRole(idx, role) {
  const p = players[idx];
  p.roles = [role]; // Basitle≈ütirmek i√ßin tek rol
  save(); renderPlayers();
}

function createTeams() {
  const field = document.getElementById('tacticalField');
  field.querySelectorAll('.player, .ball').forEach(el => el.remove());
  
  // Topu Merkeze Koy
  const ball = document.createElement('div');
  ball.className = 'ball'; ball.innerHTML = '‚öΩ';
  ball.style.top = '50%'; ball.style.left = '50%';
  makeDraggable(ball);
  field.appendChild(ball);

  // Takƒ±mlarƒ± B√∂l
  const teamA = players.slice(0, Math.ceil(players.length / 2));
  const teamB = players.slice(Math.ceil(players.length / 2));

  const drawTeam = (team, color, map, isLeft) => {
    let dIdx = 0, mIdx = 0;
    team.forEach((p) => {
      const el = document.createElement('div');
      el.className = 'player';
      el.textContent = p.name;
      el.style.backgroundColor = color;

      let pos = { x: 50, y: 50 };
      if (p.roles.includes('GK')) pos = map.GK;
      else if (p.roles.includes('FWD')) pos = map.FWD;
      else if (p.roles.includes('DEF')) { pos = map.DEF[dIdx % map.DEF.length]; dIdx++; }
      else { pos = map.MID[mIdx % map.MID.length]; mIdx++; }

      el.style.left = pos.x + "%";
      el.style.top = pos.y + "%";

      el.addEventListener('mousedown', (e) => {
        if (!e.ctrlKey) {
          selectedElements.forEach(i => i.classList.remove('selected'));
          selectedElements = [el];
          el.classList.add('selected');
        }
      });

      makeDraggable(el);
      field.appendChild(el);
    });
  };

  drawTeam(teamA, '#f3a616', posMapA, true);  // Turuncu
  drawTeam(teamB, '#43d1f0', posMapB, false); // Mavi
}

function makeDraggable(el) {
  let isDragging = false;
  let startX, startY, initialLeft, initialTop;

  const start = (e) => {
    isDragging = true;
    const clientX = e.clientX || e.touches[0].clientX;
    const clientY = e.clientY || e.touches[0].clientY;
    startX = clientX;
    startY = clientY;
    initialLeft = el.offsetLeft;
    initialTop = el.offsetTop;
    el.style.cursor = 'grabbing';
  };

  const move = (e) => {
    if (!isDragging) return;
    const clientX = e.clientX || e.touches[0].clientX;
    const clientY = e.clientY || e.touches[0].clientY;
    const dx = clientX - startX;
    const dy = clientY - startY;
    el.style.left = (initialLeft + dx) + "px";
    el.style.top = (initialTop + dy) + "px";
  };

  const end = () => {
    isDragging = false;
    el.style.cursor = 'grab';
  };

  el.addEventListener('mousedown', start);
  window.addEventListener('mousemove', move);
  window.addEventListener('mouseup', end);
  el.addEventListener('touchstart', start, {passive: false});
  window.addEventListener('touchmove', move, {passive: false});
  window.addEventListener('touchend', end);
}

function save() { localStorage.setItem(STORAGE_KEY, JSON.stringify(players)); }

function shareImage() {
  const f = document.getElementById('tacticalField');
  html2canvas(f).then(canvas => {
    const a = document.createElement('a');
    a.href = canvas.toDataURL("image/png");
    a.download = 'taktik-pro.png';
    a.click();
  });
}
</script>
</body>
</html>
