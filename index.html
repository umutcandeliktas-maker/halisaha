<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Halƒ± Saha Pro - Taktik Tahtasƒ±</title>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .field-container { position: relative; margin: 20px auto; width: fit-content; padding-bottom: 40px; }
    .field {
      position: relative;
      width: 1000px;
      height: 500px;
      background-color: #15803d;
      border: 5px solid white;
      border-radius: 12px;
      overflow: hidden;
      resize: both;
      min-width: 600px;
      min-height: 300px;
      touch-action: none;
    }
    .field::after { content: "‚åü"; position: absolute; bottom: 0; right: 5px; color: white; font-size: 30px; pointer-events: none; }
    .line { position: absolute; background: white; }
    .center-line { top: 0; left: 50%; width: 2px; height: 100%; transform: translateX(-50%); }
    .center-circle { top: 50%; left: 50%; width: 100px; height: 100px; border: 2px solid white; border-radius: 50%; transform: translate(-50%, -50%); }
    .goal { position: absolute; width: 15px; height: 120px; border: 3px solid white; top: 50%; transform: translateY(-50%); background: rgba(255,255,255,0.1); }
    .penalty-area-a { position: absolute; left: 0; top: 50%; transform: translateY(-50%); width: 100px; height: 260px; border: 2px solid white; border-left: none; }
    .penalty-area-b { position: absolute; right: 0; top: 50%; transform: translateY(-50%); width: 100px; height: 260px; border: 2px solid white; border-right: none; }
    .player {
      position: absolute;
      padding: 8px 18px;
      border-radius: 50px;
      font-weight: bold;
      color: black;
      cursor: grab;
      user-select: none;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
      z-index: 10;
      white-space: nowrap;
      border: 2px solid rgba(0,0,0,0.2);
      font-size: 14px;
    }
    .player:active { cursor: grabbing; transform: scale(1.1); z-index: 100; }
    .ball { position: absolute; width: 35px; height: 35px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; z-index: 50; box-shadow: 0 4px 10px rgba(0,0,0,0.5); }
  </style>
</head>
<body class="bg-slate-900 text-white font-sans">

<header class="bg-slate-800 text-center text-2xl font-black py-4 border-b-4 border-green-500 shadow-2xl">
  ‚öΩ HALI SAHA STRATEJƒ∞ MERKEZƒ∞
</header>

<div class="container mx-auto p-4">
  <div class="bg-slate-800 p-6 rounded-2xl mb-6 shadow-xl border border-slate-700">
    <div class="flex flex-wrap gap-6 items-center justify-between">
      <div class="flex items-center gap-4">
        <div class="flex flex-col">
          <label class="text-xs text-slate-400 mb-1 font-bold">OYUNCU SAYISI</label>
          <select id="playerCount" class="bg-slate-700 p-2 rounded-lg w-24 outline-none border border-slate-600"></select>
        </div>
        <button onclick="generatePlayers()" class="mt-4 bg-indigo-600 hover:bg-indigo-500 px-6 py-2 rounded-lg font-bold transition-all shadow-lg">Lƒ∞STEYƒ∞ TAZELE</button>
        <button onclick="clearCache()" class="mt-4 bg-red-600 hover:bg-red-500 px-4 py-2 rounded-lg font-bold transition-all shadow-lg text-sm">üóëÔ∏è CACHE TEMƒ∞ZLE</button>
      </div>
      
      <div class="flex gap-3">
        <button onclick="createTeams()" class="bg-yellow-500 text-slate-900 px-10 py-3 rounded-full font-black shadow-lg hover:bg-yellow-400 transition-all transform hover:scale-105">üèüÔ∏è TAKIMLARI Dƒ∞Z</button>
        <button onclick="shareImage()" class="bg-green-600 px-6 py-3 rounded-full font-bold hover:bg-green-500 transition-all">üì∏ RESMƒ∞ ƒ∞NDƒ∞R</button>
      </div>
    </div>
  </div>

  <div id="players" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-8"></div>

  <div class="flex justify-center gap-8 mb-6 bg-slate-800 p-4 rounded-2xl w-fit mx-auto border border-slate-700 shadow-lg">
    <label class="flex items-center gap-3 font-bold"><input type="color" id="colorA" value="#fbbf24" class="h-10 w-10 cursor-pointer rounded-lg"> TAKIM A</label>
    <div class="w-px bg-slate-700 h-10"></div>
    <label class="flex items-center gap-3 font-bold"><input type="color" id="colorB" value="#22d3ee" class="h-10 w-10 cursor-pointer rounded-lg"> TAKIM B</label>
  </div>

  <div class="field-container">
    <div id="tacticalField" class="field">
      <div class="center-line"></div>
      <div class="center-circle"></div>
      <div class="penalty-area-a"></div>
      <div class="penalty-area-b"></div>
      <div class="goal" style="left:-6px;"></div>
      <div class="goal" style="right:-6px;"></div>
    </div>
  </div>
</div>

<script>
let players = [];
const STORAGE_KEY = 'halisaha_v5_clean';

document.addEventListener('DOMContentLoaded', () => {
  const select = document.getElementById('playerCount');
  for (let i = 2; i <= 22; i++) {
    const opt = document.createElement('option');
    opt.value = i; opt.textContent = i;
    if(i === 14) opt.selected = true;
    select.appendChild(opt);
  }
  if (localStorage.getItem(STORAGE_KEY)) {
    players = JSON.parse(localStorage.getItem(STORAGE_KEY));
    renderPlayers();
  }
});

function save() { localStorage.setItem(STORAGE_KEY, JSON.stringify(players)); }

function clearCache() {
  if (confirm("T√ºm oyuncu listesi ve ayarlar silinecek. Emin misin kanka?")) {
    localStorage.removeItem(STORAGE_KEY);
    location.reload();
  }
}

function generatePlayers() {
  const count = Number(document.getElementById('playerCount').value);
  players = [];
  for (let i = 1; i <= count; i++) {
    // BURASI DEƒûƒ∞≈ûTƒ∞: Roles artƒ±k bo≈ü dizi olarak ba≈ülƒ±yor
    players.push({ name: `Oyuncu ${i}`, power: 3, roles: [] });
  }
  save();
  renderPlayers();
}

function renderPlayers() {
  const div = document.getElementById('players');
  div.innerHTML = '';
  players.forEach((p, i) => {
    const card = document.createElement('div');
    card.className = 'bg-slate-800 p-4 rounded-xl flex flex-col gap-3 border border-slate-700 shadow-md hover:border-indigo-500 transition-all';
    card.innerHTML = `
      <div class="flex gap-2">
        <input value="${p.name}" onchange="players[${i}].name=this.value;save()" class="bg-slate-900 text-white p-2 rounded-lg w-full outline-none text-sm font-bold border border-slate-700">
        <select onchange="players[${i}].power=Number(this.value);save()" class="bg-slate-900 text-yellow-400 p-2 rounded-lg text-xs font-bold outline-none border border-slate-700">
          ${[1,2,3,4,5].map(v => `<option value="${v}" ${p.power==v?'selected':''}>‚≠ê ${v}</option>`).join('')}
        </select>
      </div>
      <div class="flex flex-wrap gap-1">
        ${['GK','DEF','MID','FWD'].map(role => `
          <button onclick="toggleRole(${i},'${role}')" 
            class="flex-1 text-[10px] py-2 rounded-lg transition-all font-black
            ${p.roles.includes(role) ? 'bg-indigo-500 text-white shadow-lg' : 'bg-slate-700 text-slate-400 hover:bg-slate-600'}">
            ${role}
          </button>
        `).join('')}
      </div>
    `;
    div.appendChild(card);
  });
}

function toggleRole(playerIdx, role) {
  const currentRoles = players[playerIdx].roles;
  if (currentRoles.includes(role)) {
    players[playerIdx].roles = currentRoles.filter(r => r !== role);
  } else {
    players[playerIdx].roles.push(role);
  }
  save();
  renderPlayers();
}

function createTeams() {
  const field = document.getElementById('tacticalField');
  const staticElements = field.querySelectorAll('.center-line, .center-circle, .penalty-area-a, .penalty-area-b, .goal');
  field.innerHTML = '';
  staticElements.forEach(el => field.appendChild(el));

  const sorted = [...players].sort((a,b) => b.power - a.power);
  const teamA = [], teamB = [];
  sorted.forEach((p, idx) => { (idx % 2 === 0) ? teamA.push(p) : teamB.push(p); });

  const ball = document.createElement('div');
  ball.className = 'ball'; ball.innerHTML = '‚öΩ';
  ball.style.top = '46%'; ball.style.left = '48.5%';
  makeDraggable(ball);
  field.appendChild(ball);

  const posMap = {
    GK: { x: 5, y: 46 },
    DEF: [{x:18, y:18}, {x:18, y:46}, {x:18, y:74}],
    MID: [{x:35, y:28}, {x:35, y:64}],
    FWD: { x: 46, y: 46 }
  };

  const drawTeam = (team, color, isLeft) => {
    let counters = { DEF: 0, MID: 0 };
    team.forEach(p => {
      const el = document.createElement('div');
      el.className = 'player';
      el.textContent = p.name;
      el.style.backgroundColor = color;
      
      // Mevki se√ßilmemi≈üse varsayƒ±lan bir nokta (orta saha civarƒ±) ata
      let selectedRole = p.roles.length > 0 ? p.roles[0] : 'MID';
      
      // √ñnceliklendirme
      if(p.roles.includes('GK')) selectedRole = 'GK';
      else if(p.roles.includes('FWD')) selectedRole = 'FWD';

      let coords = { x: 50, y: 50 };
      if(selectedRole === 'GK') coords = posMap.GK;
      else if(selectedRole === 'FWD') coords = posMap.FWD;
      else if(selectedRole === 'DEF') { coords = posMap.DEF[counters.DEF % 3]; counters.DEF++; }
      else { coords = posMap.MID[counters.MID % 2]; counters.MID++; }

      let finalX = isLeft ? coords.x : (100 - coords.x - 4);
      el.style.left = finalX + "%";
      el.style.top = coords.y + "%";
      makeDraggable(el);
      field.appendChild(el);
    });
  };

  drawTeam(teamA, document.getElementById('colorA').value, true);
  drawTeam(teamB, document.getElementById('colorB').value, false);
}

function makeDraggable(el) {
  let isDragging = false;
  let offsetX, offsetY;
  const start = (e) => {
    isDragging = true;
    const cx = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
    const cy = e.type.includes('touch') ? e.touches[0].clientY : e.clientY;
    const rect = el.getBoundingClientRect();
    offsetX = cx - rect.left; offsetY = cy - rect.top;
    el.style.zIndex = 1000;
  };
  const move = (e) => {
    if (!isDragging) return;
    const cx = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
    const cy = e.type.includes('touch') ? e.touches[0].clientY : e.clientY;
    const field = document.getElementById('tacticalField');
    const fRect = field.getBoundingClientRect();
    let nx = cx - fRect.left - offsetX;
    let ny = cy - fRect.top - offsetY;
    nx = Math.max(0, Math.min(nx, fRect.width - el.offsetWidth));
    ny = Math.max(0, Math.min(ny, fRect.height - el.offsetHeight));
    el.style.left = nx + "px"; el.style.top = ny + "px";
  };
  const end = () => { isDragging = false; el.style.zIndex = 10; };
  el.addEventListener('mousedown', start);
  window.addEventListener('mousemove', move);
  window.addEventListener('mouseup', end);
  el.addEventListener('touchstart', start, {passive: false});
  window.addEventListener('touchmove', move, {passive: false});
  window.addEventListener('touchend', end);
}

function shareImage() {
  const field = document.getElementById('tacticalField');
  html2canvas(field, { backgroundColor: '#15803d' }).then(canvas => {
    const a = document.createElement('a');
    a.href = canvas.toDataURL();
    a.download = 'halisaha-taktik-pro.png';
    a.click();
  });
}
</script>
</body>
</html>
