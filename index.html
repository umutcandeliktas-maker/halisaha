<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HalÄ±saha TakÄ±m Kurucu</title>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>
body { margin:0; font-family:Arial; background:#0f5132; color:#fff; }
header { background:#1e7f43; padding:15px; text-align:center; font-size:20px; font-weight:bold; }
.container { max-width:900px; margin:auto; padding:10px; }

button { padding:10px 14px; margin:4px; border:none; border-radius:6px; background:#ffc107; font-weight:bold; cursor:pointer; }
input, select { padding:6px; border-radius:4px; border:none; margin:2px; }

.player { background:#198754; padding:8px; border-radius:6px; margin-bottom:6px; }

.field { background:#198754; border-radius:10px; padding:10px; margin:15px 0; display:flex; flex-direction:column; align-items:center; }
.line { display:flex; justify-content:center; gap:8px; margin:5px 0; flex-wrap:wrap; }

.card {
  background:#fff; color:#000; padding:6px 8px;
  border-radius:6px; min-width:60px;
  text-align:center; font-size:13px;
  cursor:grab;
}
.card.dragging { opacity:.5; }

.name { font-weight:bold; }
.pos { font-size:12px; }
</style>
</head>

<body>

<header>âš½ HalÄ±saha TakÄ±m Kurucu</header>

<div class="container">

<h4>Oyuncu SayÄ±sÄ±</h4>
<select id="playerCount">
  <option value="">SeÃ§</option>
  ${[...Array(22)].map((_,i)=>`<option value="${i+1}">${i+1}</option>`).join('')}
</select>
<button onclick="generatePlayers()">OyuncularÄ± OluÅŸtur</button>
<button onclick="clearCache()">ğŸ§¹ Cache Temizle</button>

<hr>
<div id="players"></div>

<hr>

<label><input type="radio" name="mode" value="one" checked> Tek takÄ±m</label>
<label><input type="radio" name="mode" value="two"> Ä°ki takÄ±m</label>

<br><br>

<button onclick="createTeams()">ğŸŸï¸ TakÄ±m OluÅŸtur</button>
<button onclick="toggleVest()">ğŸ¦º Yelek DeÄŸiÅŸtir</button>
<button onclick="shareImage()">ğŸ“¸ Resim Ä°ndir</button>

<div style="margin:10px 0;">
  <label>TakÄ±m A <input type="color" id="colorA" value="#ffc107"></label>
  <label>TakÄ±m B <input type="color" id="colorB" value="#0dcaf0"></label>
</div>

<div id="teams"></div>

</div>

<script>
const playersDiv = document.getElementById('players');
const teamsDiv = document.getElementById('teams');
const colorA = document.getElementById('colorA');
const colorB = document.getElementById('colorB');
const countSelect = document.getElementById('playerCount');

let players = JSON.parse(localStorage.getItem('players')) || [];
let vestTeam = 1;

/* LOCAL STORAGE */
function save(){ localStorage.setItem('players', JSON.stringify(players)); }

/* OYUNCU OLUÅTUR */
function generatePlayers(){
  const c = Number(countSelect.value);
  if(!c) return alert("Oyuncu sayÄ±sÄ± seÃ§");

  players=[];
  for(let i=1;i<=c;i++){
    players.push({ name:`Oyuncu ${i}`, power:3, pos:[] });
  }
  save();
  renderPlayers();
  teamsDiv.innerHTML='';
}

/* OYUNCU LÄ°STESÄ° */
function renderPlayers(){
  playersDiv.innerHTML='';
  players.forEach((p,i)=>{
    playersDiv.innerHTML+=`
      <div class="player">
        <input value="${p.name}" onchange="players[${i}].name=this.value;save()">
        
        <label><input type="checkbox" ${p.pos.includes('GK')?'checked':''} onchange="togglePos(${i},'GK')"> GK</label>
        <label><input type="checkbox" ${p.pos.includes('DEF')?'checked':''} onchange="togglePos(${i},'DEF')"> DEF</label>
        <label><input type="checkbox" ${p.pos.includes('MID')?'checked':''} onchange="togglePos(${i},'MID')"> MID</label>
        <label><input type="checkbox" ${p.pos.includes('FWD')?'checked':''} onchange="togglePos(${i},'FWD')"> FWD</label>

        <select onchange="players[${i}].power=this.value;save()">
          <option ${p.power==1?'selected':''}>1</option>
          <option ${p.power==2?'selected':''}>2</option>
          <option ${p.power==3?'selected':''}>3</option>
          <option ${p.power==4?'selected':''}>4</option>
          <option ${p.power==5?'selected':''}>5</option>
        </select>
      </div>
    `;
  });
}

function togglePos(i,pos){
  const p = players[i].pos;
  players[i].pos = p.includes(pos) ? p.filter(x=>x!==pos) : [...p,pos];
  save();
}

/* YELEK */
function toggleVest(){
  vestTeam = vestTeam===1 ? 2 : 1;
  createTeams();
}

/* OTOMATÄ°K POZÄ°SYON ATAMA */
function autoPositions(team){
  const n = team.length;
  let gk=1, def=3, mid=1, fwd=2;
  if(n===6){ gk=1; def=3; mid=2; fwd=1; }
  if(n<6){ gk=1; def=Math.min(3,n-3); mid=1; fwd=n-(gk+def+mid); }
  let idx=0;
  team.forEach(p=>p.pos=[]);
  for(let i=0;i<gk;i++) team[idx++].pos.push('GK');
  for(let i=0;i<def;i++) team[idx++].pos.push('DEF');
  for(let i=0;i<mid;i++) team[idx++].pos.push('MID');
  for(let i=0;i<fwd;i++) team[idx++].pos.push('FWD');
  return team;
}

/* TAKIM OLUÅTUR */
function createTeams(){
  if(players.length===0) return alert("Oyuncu yok");

  const mode=document.querySelector('input[name="mode"]:checked').value;
  const list=[...players].sort((a,b)=>b.power-a.power);

  if(mode==='one'){
    const team=autoPositions(list);
    teamsDiv.innerHTML = teamHTML('Bizim TakÄ±m', team, false, colorA.value);
    enableDrag(); return;
  }

  let a=[], b=[], pa=0, pb=0;
  list.forEach(p=>{
    if(pa<=pb){ a.push(p); pa+=+p.power; }
    else{ b.push(p); pb+=+p.power; }
  });

  a=autoPositions(a);
  b=autoPositions(b);

  teamsDiv.innerHTML =
    teamHTML('TakÄ±m A', a, vestTeam===1, colorA.value) +
    teamHTML('TakÄ±m B', b, vestTeam===2, colorB.value);

  enableDrag();
}

/* SAHA + MEVKÄ° (ORTALANMIÅ) */
function teamHTML(title, team, vest, color){
  const lines={GK:[],DEF:[],MID:[],FWD:[]};
  team.forEach(p=>{
    const pos = p.pos[0] || 'FWD';
    lines[pos].push(p);
  });

  let html=`<h3>${vest?'ğŸ¦º ':''}${title}</h3>
  <div class="field" style="border:3px solid ${color};">`;

  ['GK','DEF','MID','FWD'].forEach(l=>{
    if(lines[l].length){
      html+=`<div class="line" style="display:flex; justify-content:center; gap:8px; margin:5px 0;">`;
      lines[l].forEach(p=>{
        html+=`
        <div class="card" draggable="true" style="border:2px solid ${color}; min-width:60px; text-align:center;">
          <div class="name">${p.name}</div>
          <div class="pos">${l} â­${p.power}</div>
        </div>`;
      });
      html+=`</div>`;
    }
  });

  html+='</div>';
  return html;
}

/* DRAG */
function enableDrag(){
  document.querySelectorAll('.card').forEach(c=>{
    c.addEventListener('dragstart',()=>c.classList.add('dragging'));
    c.addEventListener('dragend',()=>c.classList.remove('dragging'));
  });
  document.querySelectorAll('.line').forEach(l=>{
    l.addEventListener('dragover',e=>{
      e.preventDefault();
      const d=document.querySelector('.dragging');
      if(d) l.appendChild(d);
    });
  });
}

/* RESÄ°M */
function shareImage(){
  if(!teamsDiv.innerHTML) return alert("Ã–nce takÄ±m oluÅŸtur");
  html2canvas(teamsDiv).then(c=>{
    const a=document.createElement('a');
    a.href=c.toDataURL('image/png');
    a.download='halisaha-takimlar.png';
    a.click();
  });
}

/* CACHE */
function clearCache(){
  localStorage.removeItem('players');
  players=[];
  renderPlayers();
  teamsDiv.innerHTML='';
  alert('Cache temizlendi');
}

if(players.length) renderPlayers();
</script>

</body>
</html>
