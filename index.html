<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Taktik Saha FINAL</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>
body{background:#020617;color:white}

#field{
position:relative;
margin:auto;
background:radial-gradient(circle,#0a5c2a,#032b13);
border:4px solid white;
border-radius:16px;
overflow:hidden
}
.line{position:absolute;background:white;opacity:.8}
.mid{left:50%;top:0;width:2px;height:100%;transform:translateX(-50%)}
.circle{
position:absolute;width:140px;height:140px;border:2px solid white;
border-radius:50%;left:50%;top:50%;transform:translate(-50%,-50%)
}
.goal{
position:absolute;width:20px;height:120px;border:2px solid white;
top:50%;transform:translateY(-50%)
}
.goal.left{left:-20px}
.goal.right{right:-20px}

.player{
position:absolute;width:110px;
padding:6px;border-radius:10px;
text-align:center;font-weight:bold;
cursor:grab;user-select:none;
transform:translate(-50%,-50%);
transition:.25s
}
.team-a{background:#f59e0b;color:black}
.team-b{background:#38bdf8;color:black}
.vest{outline:4px dashed white}
</style>
</head>

<body class="p-4">

<div class="flex flex-wrap gap-2 mb-4">
<input id="pw" type="number" value="1100" class="bg-slate-800 p-1 w-24"> Genişlik
<input id="ph" type="number" value="650" class="bg-slate-800 p-1 w-24"> Yükseklik

<input id="count" type="number" value="7" class="bg-slate-800 p-1 w-20"> Kişi

<select id="fA" class="bg-slate-800 p-1">
<option>3-1-2</option><option>2-2-2</option><option>3-2-1</option>
</select>

<select id="fB" class="bg-slate-800 p-1">
<option>3-1-2</option><option>2-2-2</option><option>3-2-1</option>
</select>

<button onclick="createSquad()" class="bg-blue-600 px-2">Kadro Oluştur</button>
<button onclick="place()" class="bg-green-600 px-2">Sahaya Diz</button>
<button onclick="vest()" class="bg-yellow-500 px-2">Yelek</button>
<button onclick="exportPNG()" class="bg-pink-600 px-2">PNG</button>
<button onclick="resetAll()" class="bg-red-600 px-2">Reset</button>
</div>

<div id="field" style="width:1100px;height:650px">
<div class="line mid"></div>
<div class="circle"></div>
<div class="goal left"></div>
<div class="goal right"></div>
</div>

<script>
let players=[],drag=null,dx,dy,ox,oy;

const forms={
"3-1-2":[[10,50],[25,25],[25,50],[25,75],[45,50],[60,35],[60,65]],
"2-2-2":[[10,50],[25,35],[25,65],[45,30],[45,70],[60,35],[60,65]],
"3-2-1":[[10,50],[25,25],[25,50],[25,75],[45,35],[45,65],[60,50]]
};

function resize(){
field.style.width=pw.value+"px";
field.style.height=ph.value+"px";
}
pw.oninput=ph.oninput=resize;

function createSquad(){
players=[];
let n=+count.value;
for(let i=0;i<n*2;i++){
players.push({id:i,team:i<n?"A":"B",name:"Oyuncu "+(i+1)});
}
alert("Yeni kadro oluşturuldu");
}

function place(){
document.querySelectorAll(".player").forEach(e=>e.remove());
["A","B"].forEach(t=>{
let f=t==="A"?fA.value:fB.value;
let coords=forms[f];
players.filter(p=>p.team===t).forEach((p,i)=>{
let [xp,yp]=coords[i%coords.length];
spawn(p,xp,yp,t);
});
});
}

function spawn(p,xp,yp,t){
let d=document.createElement("div");
d.className="player "+(t==="A"?"team-a":"team-b");
d.textContent=p.name;
d.dataset.id=p.id;

let w=field.clientWidth,h=field.clientHeight;
let base=t==="A"?0.05:0.5;
let fx=base+(xp/100)*0.45;

d.style.left=(fx*w)+"px";
d.style.top=(yp/100*h)+"px";

d.ondblclick=()=>switchTeam(d);
d.onmousedown=e=>{
drag=d;dx=e.clientX;dy=e.clientY;
ox=d.offsetLeft;oy=d.offsetTop;
};

field.appendChild(d);
}

window.onmousemove=e=>{
if(!drag) return;
drag.style.left=ox+e.clientX-dx+"px";
drag.style.top=oy+e.clientY-dy+"px";
};
window.onmouseup=()=>drag=null;

function switchTeam(el){
let p=players.find(x=>x.id==el.dataset.id);
p.team=p.team==="A"?"B":"A";
el.classList.toggle("team-a");
el.classList.toggle("team-b");
el.style.left=(field.clientWidth-el.offsetLeft)+"px";
}

function vest(){
document.querySelectorAll(".player").forEach(p=>p.classList.remove("vest"));
let t=Math.random()<.5?"team-a":"team-b";
document.querySelectorAll("."+t).forEach(p=>p.classList.add("vest"));
}

function exportPNG(){
html2canvas(field).then(c=>{
let a=document.createElement("a");
a.href=c.toDataURL();a.download="saha.png";a.click();
});
}

function resetAll(){
players=[];
document.querySelectorAll(".player").forEach(e=>e.remove());
}
</script>
</body>
</html>
