<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Taktik Pro - Dev Saha</title>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .field-container { position: relative; margin: 20px auto; width: fit-content; }
    .field {
      position: relative;
      width: 1200px; /* Saha Geni≈ületildi */
      height: 700px; /* Saha Y√ºkseltildi */
      background-color: #1a8a42;
      border: 5px solid white; border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 20px 50px rgba(0,0,0,0.5);
    }
    .center-line { position: absolute; top: 0; left: 50%; width: 2px; height: 100%; transform: translateX(-50%); background: rgba(255,255,255,0.7); }
    .center-circle { position: absolute; top: 50%; left: 50%; width: 150px; height: 150px; border: 2px solid white; border-radius: 50%; transform: translate(-50%, -50%); }
    
    /* KALELER */
    .goal-post { 
      position: absolute; top: 50%; transform: translateY(-50%); 
      width: 30px; height: 180px; border: 4px solid white; background: rgba(255,255,255,0.15); 
      z-index: 5;
    }
    .goal-left { left: -5px; border-left: none; border-radius: 0 10px 10px 0; }
    .goal-right { right: -5px; border-right: none; border-radius: 10px 0 0 10px; }

    /* CEZA SAHALARI */
    .penalty-box { position: absolute; border: 2px solid white; top: 50%; transform: translateY(-50%); height: 400px; width: 160px; }
    
    .player {
      position: absolute; width: 120px; padding: 12px 5px; border-radius: 25px;
      font-weight: bold; color: black; cursor: grab; z-index: 10; text-align: center;
      border: 2px solid rgba(0,0,0,0.2); user-select: none; font-size: 14px;
      box-shadow: 0 6px 10px rgba(0,0,0,0.3); transform: translate(-50%, -50%);
      transition: transform 0.1s;
    }
    .player:active { transform: translate(-50%, -50%) scale(1.1); }
    .player.selected { outline: 5px solid white; box-shadow: 0 0 25px white; z-index: 50; }
    
    .ball {
      position: absolute; width: 40px; height: 40px; background: white; border-radius: 50%;
      display: flex; align-items: center; justify-content: center; z-index: 60;
      box-shadow: 0 5px 15px rgba(0,0,0,0.6); cursor: grab; transform: translate(-50%, -50%);
      font-size: 24px;
    }
  </style>
</head>
<body class="bg-slate-900 text-white font-sans">

<header class="bg-slate-800 text-center text-3xl font-black py-6 border-b-4 border-green-600 shadow-2xl">
  ‚öΩ PRO TAKTƒ∞K TAHTASI v8.5
</header>

<div class="container mx-auto p-4">
  <div class="bg-slate-800 p-5 rounded-2xl mb-8 flex flex-wrap gap-5 items-center justify-between border border-slate-700 shadow-xl">
    <div class="flex gap-4">
      <select id="playerCount" class="bg-slate-700 p-3 rounded-xl outline-none border border-slate-600 font-bold text-green-400"></select>
      <button onclick="generatePlayers()" class="bg-indigo-600 px-6 py-2 rounded-xl font-bold hover:bg-indigo-500 transition-colors">KADROYU YAZ</button>
      <button onclick="clearCache()" class="bg-red-600 px-6 py-2 rounded-xl font-bold hover:bg-red-500 transition-colors">TEMƒ∞ZLE</button>
    </div>
    <div class="flex gap-4">
      <button onclick="createTeams()" class="bg-yellow-500 text-black px-12 py-4 rounded-full font-black shadow-lg hover:scale-105 active:scale-95 transition-all">üèüÔ∏è SAHAYA Dƒ∞Z</button>
      <button onclick="shareImage()" class="bg-green-600 px-8 py-4 rounded-full font-bold hover:bg-green-500 transition-all">üì∏ KAYDET</button>
    </div>
  </div>

  <div id="players" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-5 mb-10"></div>

  <div class="field-container">
    <div id="tacticalField" class="field">
      <div class="center-line"></div>
      <div class="center-circle"></div>
      
      <div class="goal-post goal-left"></div>
      <div class="goal-post goal-right"></div>

      <div class="penalty-box" style="left:0; border-left:none;"></div>
      <div class="penalty-box" style="right:0; border-right:none;"></div>
      
      <div class="ball" id="gameBall">‚öΩ</div>
    </div>
  </div>
</div>

<script>
let players = [];
let selectedElements = [];
const STORAGE_KEY = 'halisaha_v8_wide';

// G√ñRSELDEKƒ∞ TAM KOORDƒ∞NATLAR (Saha b√ºy√ºd√ºƒü√º i√ßin oranlar g√ºncellendi)
const posMapA = { 
  GK: {x:5, y:50}, 
  DEF: [{x:15, y:50}, {x:18, y:18}, {x:18, y:82}], 
  MID: [{x:32, y:32}, {x:32, y:68}], 
  FWD: {x:45, y:50} 
};

const posMapB = { 
  GK: {x:95, y:50}, 
  DEF: [{x:85, y:50}, {x:82, y:18}, {x:82, y:82}], 
  MID: [{x:68, y:32}, {x:68, y:68}], 
  FWD: {x:55, y:50} 
};

document.addEventListener('DOMContentLoaded', () => {
  const select = document.getElementById('playerCount');
  for (let i = 2; i <= 22; i+=2) {
    const opt = document.createElement('option');
    opt.value = i; opt.textContent = i + " Oyuncu (" + (i/2) + "v" + (i/2) + ")";
    if(i === 14) opt.selected = true;
    select.appendChild(opt);
  }
  if (localStorage.getItem(STORAGE_KEY)) {
    players = JSON.parse(localStorage.getItem(STORAGE_KEY));
  } else { generatePlayers(); }
  renderPlayers();
  makeDraggable(document.getElementById('gameBall'));
});

function generatePlayers() {
  const count = Number(document.getElementById('playerCount').value);
  players = [];
  for (let i = 1; i <= count; i++) players.push({ name: `Oyuncu ${i}`, power: 3, roles: [] });
  save(); renderPlayers();
}

function renderPlayers() {
  const div = document.getElementById('players');
  div.innerHTML = '';
  players.forEach((p, i) => {
    const card = document.createElement('div');
    card.className = 'bg-slate-800 p-4 rounded-2xl border border-slate-700 shadow-lg';
    card.innerHTML = `
      <div class="flex gap-2 mb-3">
        <input value="${p.name}" onchange="players[${i}].name=this.value;save()" class="bg-slate-900 text-white p-2 rounded-lg w-full text-sm outline-none border border-slate-700 focus:border-indigo-500">
        <select onchange="players[${i}].power=Number(this.value);save()" class="bg-slate-900 text-yellow-500 p-1 rounded-lg text-xs font-bold">
          ${[1,2,3,4,5].map(v => `<option value="${v}" ${p.power==v?'selected':''}>‚≠ê${v}</option>`).join('')}
        </select>
      </div>
      <div class="flex gap-1">
        ${['GK','DEF','MID','FWD'].map(role => `
          <button onclick="toggleRole(${i},'${role}')" class="flex-1 text-[11px] py-2 rounded-lg transition-all ${p.roles.includes(role)?'bg-indigo-600 text-white font-bold':'bg-slate-700 text-slate-400'}">${role}</button>
        `).join('')}
      </div>
    `;
    div.appendChild(card);
  });
}

function toggleRole(idx, role) {
  const p = players[idx];
  p.roles.includes(role) ? p.roles = p.roles.filter(r => r !== role) : p.roles.push(role);
  save(); renderPlayers();
}

function createTeams() {
  const field = document.getElementById('tacticalField');
  field.querySelectorAll('.player').forEach(el => el.remove());

  const sorted = [...players].sort((a,b) => b.power - a.power);
  const teamA = [], teamB = [];
  sorted.forEach((p, idx) => (idx % 2 === 0) ? teamA.push(p) : teamB.push(p));

  const placePlayers = (team, color, map) => {
    let dIdx = 0, mIdx = 0, gkUsed = false, fwdUsed = false;
    team.forEach((p) => {
      const el = document.createElement('div');
      el.className = 'player';
      el.textContent = p.name;
      el.style.backgroundColor = color;
      
      let pos = {x: 50, y: 50};
      if(p.roles.includes('GK') && !gkUsed) { pos = map.GK; gkUsed = true; }
      else if(p.roles.includes('FWD') && !fwdUsed) { pos = map.FWD; fwdUsed = true; }
      else if(p.roles.includes('DEF')) { pos = map.DEF[dIdx % map.DEF.length]; dIdx++; }
      else if(p.roles.includes('MID')) { pos = map.MID[mIdx % map.MID.length]; mIdx++; }
      else {
         if(!gkUsed) { pos = map.GK; gkUsed = true; }
         else if(dIdx < map.DEF.length) { pos = map.DEF[dIdx]; dIdx++; }
         else if(mIdx < map.MID.length) { pos = map.MID[mIdx]; mIdx++; }
         else { pos = map.FWD; }
      }
      el.style.left = pos.x + "%"; el.style.top = pos.y + "%";
      el.addEventListener('mousedown', () => {
        selectedElements.forEach(i => i.classList.remove('selected'));
        selectedElements = [el]; el.classList.add('selected');
      });
      makeDraggable(el);
      field.appendChild(el);
    });
  };
  placePlayers(teamA, '#f3a616', posMapA);
  placePlayers(teamB, '#43d1f0', posMapB);
}

function makeDraggable(el) {
  let isDragging = false, startX, startY, initL, initT;
  const start = (e) => {
    isDragging = true;
    const cx = (e.clientX || e.touches[0].clientX);
    const cy = (e.clientY || e.touches[0].clientY);
    startX = cx; startY = cy;
    initL = el.offsetLeft; initT = el.offsetTop;
  };
  const move = (e) => {
    if (!isDragging) return;
    const cx = (e.clientX || e.touches[0].clientX);
    const cy = (e.clientY || e.touches[0].clientY);
    el.style.left = (initL + (cx - startX)) + "px";
    el.style.top = (initT + (cy - startY)) + "px";
  };
  const end = () => isDragging = false;
  el.addEventListener('mousedown', start);
  window.addEventListener('mousemove', move);
  window.addEventListener('mouseup', end);
  el.addEventListener('touchstart', start, {passive:false});
  window.addEventListener('touchmove', move, {passive:false});
  window.addEventListener('touchend', end);
}

function save() { localStorage.setItem(STORAGE_KEY, JSON.stringify(players)); }
function clearCache() { if(confirm("T√ºm liste temizlensin mi?")) { localStorage.removeItem(STORAGE_KEY); location.reload(); } }
function shareImage() {
  const f = document.getElementById('tacticalField');
  html2canvas(f, {backgroundColor: '#1a8a42'}).then(canvas => {
    const a = document.createElement('a'); a.href = canvas.toDataURL(); a.download = 'halisaha-taktik.png'; a.click();
  });
}
</script>
</body>
</html>
