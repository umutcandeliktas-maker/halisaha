<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Taktik Pro v11.4 - Kesin Dizilim Fix</title>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .field-container { position: relative; margin: 20px auto; width: fit-content; }
    .field {
      position: relative; width: 1100px; height: 650px; background-color: #032b13;
      border: 5px solid white; border-radius: 15px; overflow: hidden;
      box-shadow: 0 25px 50px rgba(0,0,0,0.8);
      background: radial-gradient(circle, #064d23 0%, #021a0b 100%);
    }
    .player {
      position: absolute; width: 115px; padding: 10px 5px; border-radius: 14px;
      font-weight: bold; color: black; cursor: grab; z-index: 10; text-align: center;
      border: 2px solid rgba(0,0,0,0.3); user-select: none; font-size: 13px;
      box-shadow: 0 10px 20px rgba(0,0,0,0.6); transform: translate(-50%, -50%);
      transition: all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    .player.team-a { background: linear-gradient(135deg, #f3a616 0%, #d48c0a 100%); }
    .player.team-b { background: linear-gradient(135deg, #43d1f0 0%, #2ba5c2 100%); }
    .player .q-tag { font-size: 10px; opacity: 0.9; display: block; margin-top: 2px; border-top: 1px solid rgba(0,0,0,0.15); }
    .ball {
      position: absolute; width: 42px; height: 42px; background: white; border-radius: 50%;
      display: flex; align-items: center; justify-content: center; z-index: 60;
      box-shadow: 0 4px 20px rgba(0,0,0,0.9); cursor: grab; transform: translate(-50%, -50%);
      font-size: 26px; border: 2px solid #222;
    }
    /* Saha Çizgileri */
    .line { position: absolute; background: rgba(255,255,255,0.6); }
    .center-line { top: 0; left: 50%; width: 2px; height: 100%; transform: translateX(-50%); }
    .center-circle { top: 50%; left: 50%; width: 140px; height: 140px; border: 2px solid white; border-radius: 50%; transform: translate(-50%, -50%); }
    .goal-post { position: absolute; top: 50%; transform: translateY(-50%); width: 45px; height: 180px; border: 4px solid white; }
    .goal-l { left: -5px; } .goal-r { right: -5px; }
  </style>
</head>
<body class="bg-slate-950 text-white font-sans">

<div class="container mx-auto p-4">
  <div class="bg-slate-900 p-6 rounded-3xl mb-8 flex flex-wrap gap-6 items-end justify-between border border-slate-800">
    <div class="flex gap-4">
      <div class="flex flex-col">
        <label class="text-[10px] text-orange-500 font-bold mb-1 uppercase">A TAKIMI TAKTİK</label>
        <select id="formA" onchange="teamForms.A=this.value; drawTactics();" class="bg-slate-800 p-3 rounded-xl border border-orange-500/30 text-orange-400 w-32 outline-none">
          <option value="3-1-2">3-1-2</option>
          <option value="2-2-2">2-2-2</option>
          <option value="3-2-1">3-2-1</option>
        </select>
      </div>
      <div class="flex flex-col">
        <label class="text-[10px] text-cyan-500 font-bold mb-1 uppercase">B TAKIMI TAKTİK</label>
        <select id="formB" onchange="teamForms.B=this.value; drawTactics();" class="bg-slate-800 p-3 rounded-xl border border-cyan-500/30 text-cyan-400 w-32 outline-none">
          <option value="3-1-2">3-1-2</option>
          <option value="2-2-2">2-2-2</option>
          <option value="3-2-1">3-2-1</option>
        </select>
      </div>
    </div>
    <div class="flex gap-2">
      <button onclick="createList()" class="bg-blue-600 px-6 py-3 rounded-xl font-bold text-xs">1. LİSTEYİ KUR</button>
      <button onclick="drawTactics()" class="bg-green-500 text-black px-8 py-3 rounded-xl font-black text-xs uppercase">2. SAHAYA DİZ</button>
    </div>
  </div>

  <div id="playerList" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-3 mb-10"></div>

  <div id="field" class="field mx-auto shadow-2xl">
    <div class="line center-line"></div>
    <div class="center-circle"></div>
    <div class="goal-post goal-l"></div>
    <div class="goal-post goal-r"></div>
    <div id="ball" class="ball" style="left: 50%; top: 50%;">⚽</div>
  </div>
</div>

<script>
let squad = [];
let teamForms = { A: "3-1-2", B: "3-1-2" };

// Koordinatlar her takımın 7 kişisine (1 GK + 6 Saha) göre tam listelendi
const formations = {
  "3-1-2": {
    DEF: [{x:18,y:20}, {x:18,y:80}, {x:28,y:50}], 
    MID: [{x:40,y:50}], 
    FWD: [{x:42,y:20}, {x:42,y:80}]
  },
  "2-2-2": {
    DEF: [{x:18,y:30}, {x:18,y:70}], 
    MID: [{x:32,y:25}, {x:32,y:75}], 
    FWD: [{x:45,y:30}, {x:45,y:70}]
  },
  "3-2-1": {
    DEF: [{x:18,y:20}, {x:18,y:50}, {x:18,y:80}], 
    MID: [{x:33,y:35}, {x:33,y:65}], 
    FWD: [{x:46,y:50}]
  }
};

function createList() {
  squad = [];
  for(let i=0; i<14; i++) {
    let t = i < 7 ? 'A' : 'B';
    let r = "DEF";
    if(i === 0 || i === 7) r = "GK";
    else if(i === 6 || i === 13) r = "FWD";
    else if(i === 5 || i === 12) r = "MID";
    
    squad.push({ id: i, name: `Oyuncu ${i+1}`, team: t, role: r });
  }
  renderList();
}

function setRole(idx, role) {
  squad[idx].role = role;
  renderList();
  drawTactics();
}

function renderList() {
  const container = document.getElementById('playerList');
  container.innerHTML = squad.map((p, i) => `
    <div class="bg-slate-900 p-2 rounded-xl border border-slate-800">
      <input onchange="squad[${i}].name=this.value; drawTactics();" value="${p.name}" class="bg-slate-950 text-[10px] p-1 w-full rounded mb-1 text-white">
      <div class="grid grid-cols-2 gap-1">
        ${['GK','DEF','MID','FWD'].map(r => `
          <button onclick="setRole(${i}, '${r}')" class="text-[8px] py-1 rounded font-bold ${p.role===r ? (p.team==='A'?'bg-orange-600':'bg-cyan-600') : 'bg-slate-800 text-slate-500'}">${r}</button>
        `).join('')}
      </div>
    </div>
  `).join('');
}

function drawTactics() {
  const f = document.getElementById('field');
  f.querySelectorAll('.player').forEach(p => p.remove());
  
  let counters = { A_DEF:0, A_MID:0, A_FWD:0, B_DEF:0, B_MID:0, B_FWD:0 };

  squad.forEach((p) => {
    const el = document.createElement('div');
    el.className = `player team-${p.team.toLowerCase()}`;
    const role = p.role;
    const layout = formations[teamForms[p.team]];
    
    el.innerHTML = `<div>${p.name}</div><span class="q-tag">⭐ 5 - ${role}</span>`;
    
    let pos = {x:50, y:50};
    if (role === 'GK') {
      pos = p.team === 'A' ? {x:7, y:50} : {x:93, y:50};
    } else {
      const coords = layout[role] || [{x:50,y:50}];
      let cIdx = counters[`${p.team}_${role}`];
      
      // Eğer oyuncu sayısı koordinat sayısından fazlaysa başa dön (üst üste binmeyi önlemek için küçük ofset ekle)
      let base = coords[cIdx % coords.length];
      let offset = Math.floor(cIdx / coords.length) * 3; 

      pos = p.team === 'A' ? {x: base.x, y: base.y + offset} : {x: 100 - base.x, y: base.y + offset};
      counters[`${p.team}_${role}`]++;
    }
    
    el.style.left = (pos.x * 11) + "px";
    el.style.top = (pos.y * 6.5) + "px";
    drag(el);
    f.appendChild(el);
  });
  drag(document.getElementById('ball'));
}

function drag(el) {
  let active = false, startX, startY, initX, initY;
  const evStart = (e) => {
    active = true;
    const c = e.touches ? e.touches[0] : e;
    startX = c.clientX; startY = c.clientY;
    initX = el.offsetLeft; initY = el.offsetTop;
    el.style.transition = 'none';
  };
  const evMove = (e) => {
    if (!active) return;
    const c = e.touches ? e.touches[0] : e;
    el.style.left = (initX + (c.clientX - startX)) + "px";
    el.style.top = (initY + (c.clientY - startY)) + "px";
  };
  const evEnd = () => {
    active = false;
    el.style.transition = 'all 0.4s ease-out';
  };
  el.addEventListener('mousedown', evStart);
  el.addEventListener('touchstart', evStart, {passive: true});
  window.addEventListener('mousemove', evMove);
  window.addEventListener('touchmove', evMove, {passive: false});
  window.addEventListener('mouseup', evEnd);
  window.addEventListener('touchend', evEnd);
}
</script>
</body>
</html>
