<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mini HalÄ± Saha TakÄ±m Kurucu</title>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-green-900 text-white font-sans">

<header class="bg-green-700 text-center text-xl font-bold py-4">âš½ Mini HalÄ± Saha TakÄ±m Kurucu</header>

<div class="container mx-auto p-4">

<!-- Oyuncu SayÄ±sÄ± -->
<div class="mb-4">
  <label class="mr-2">Oyuncu SayÄ±sÄ±:</label>
  <select id="playerCount" class="text-black p-1 rounded"></select>
  <button onclick="generatePlayers()" class="bg-yellow-500 text-black px-3 py-1 rounded font-bold ml-2">OluÅŸtur</button>
  <button onclick="clearCache()" class="bg-red-600 px-3 py-1 rounded font-bold ml-2">Cache Temizle</button>
</div>

<!-- Oyuncular -->
<div id="players" class="mb-4"></div>

<!-- Mod SeÃ§imi -->
<div class="mb-4">
  <label class="mr-4"><input type="radio" name="mode" value="one" checked> Tek takÄ±m</label>
  <label><input type="radio" name="mode" value="two"> Ä°ki takÄ±m</label>
</div>

<!-- Butonlar -->
<div class="mb-4">
  <button onclick="createTeams()" class="bg-yellow-500 text-black px-3 py-1 rounded font-bold mr-2">ğŸŸï¸ TakÄ±m OluÅŸtur</button>
  <button onclick="toggleVest()" class="bg-blue-500 px-3 py-1 rounded font-bold mr-2">ğŸ¦º Yelek DeÄŸiÅŸtir</button>
  <button onclick="shareImage()" class="bg-green-500 px-3 py-1 rounded font-bold">ğŸ“¸ Resim Ä°ndir</button>
</div>

<!-- Renkler -->
<div class="mb-4">
  <label class="mr-2">TakÄ±m A: <input type="color" id="colorA" value="#ffc107"></label>
  <label>TakÄ±m B: <input type="color" id="colorB" value="#0dcaf0"></label>
</div>

<!-- Mini Saha -->
<div id="teams" class="relative mx-auto w-full max-w-3xl" style="height:400px;"></div>

</div>

<script>
// ====== Liste Kutusu ======
document.addEventListener('DOMContentLoaded', ()=>{
  const playerCountSelect = document.getElementById('playerCount');
  for(let i=1;i<=22;i++){
      const option = document.createElement('option');
      option.value = i;
      option.textContent = i;
      playerCountSelect.appendChild(option);
  }

  if(localStorage.getItem('players')){
    players = JSON.parse(localStorage.getItem('players'));
    renderPlayers();
  }
});

// ======= GLOBAL =======
let players = [];
let vestTeam = 1;

const playersDiv = document.getElementById('players');
const teamsDiv = document.getElementById('teams');
const colorA = document.getElementById('colorA');
const colorB = document.getElementById('colorB');

// ======= LOCAL STORAGE =======
function save(){ localStorage.setItem('players', JSON.stringify(players)); }

// ======= OYUNCU OLUÅTUR =======
function generatePlayers(){
  const c = Number(document.getElementById('playerCount').value);
  if(!c) return alert("Oyuncu sayÄ±sÄ± seÃ§");
  players=[];
  for(let i=1;i<=c;i++) players.push({ name:`Oyuncu ${i}`, power:3, pos:[] });
  save();
  renderPlayers();
  teamsDiv.innerHTML='';
}

// ======= OYUNCU LÄ°STESÄ° =======
function renderPlayers(){
  playersDiv.innerHTML='';
  players.forEach((p,i)=>{
    const div=document.createElement('div');
    div.className='bg-green-700 p-2 rounded mb-2 flex flex-wrap items-center gap-2';
    div.innerHTML=`
      <input value="${p.name}" onchange="players[${i}].name=this.value;save()" class="text-black p-1 rounded">
      <label><input type="checkbox" ${p.pos.includes('GK')?'checked':''} onchange="togglePos(${i},'GK')"> GK</label>
      <label><input type="checkbox" ${p.pos.includes('DEF')?'checked':''} onchange="togglePos(${i},'DEF')"> DEF</label>
      <label><input type="checkbox" ${p.pos.includes('MID')?'checked':''} onchange="togglePos(${i},'MID')"> MID</label>
      <label><input type="checkbox" ${p.pos.includes('FWD')?'checked':''} onchange="togglePos(${i},'FWD')"> FWD</label>
      <select onchange="players[${i}].power=this.value;save()" class="text-black p-1 rounded">
        <option ${p.power==1?'selected':''}>1</option>
        <option ${p.power==2?'selected':''}>2</option>
        <option ${p.power==3?'selected':''}>3</option>
        <option ${p.power==4?'selected':''}>4</option>
        <option ${p.power==5?'selected':''}>5</option>
      </select>
    `;
    playersDiv.appendChild(div);
  });
}

function togglePos(i,pos){
  const p = players[i].pos;
  players[i].pos = p.includes(pos) ? p.filter(x=>x!==pos) : [...p,pos];
  save();
}

// ======= YELEK =======
function toggleVest(){
  if(players.length===0) return;
  vestTeam = Math.random()<0.5 ? 1 : 2;
  createTeams();
}

// ======= OTOMATÄ°K POZÄ°SYON =======
function autoPositions(team){
  const n = team.length;
  let gk=1, def=3, mid=1, fwd=2;
  if(n===6){ gk=1; def=3; mid=2; fwd=1; }
  if(n<6){ gk=1; def=Math.min(3,n-3); mid=1; fwd=n-(gk+def+mid); }
  let idx=0;
  team.forEach(p=>p.pos=[]);
  for(let i=0;i<gk;i++) team[idx++].pos.push('GK');
  for(let i=0;i<def;i++) team[idx++].pos.push('DEF');
  for(let i=0;i<mid;i++) team[idx++].pos.push('MID');
  for(let i=0;i<fwd;i++) team[idx++].pos.push('FWD');
  return team;
}

// ======= TAKIM OLUÅTUR =======
function createTeams(){
  if(players.length===0) return alert("Oyuncu yok");
  const mode=document.querySelector('input[name="mode"]:checked').value;
  const list=[...players].sort((a,b)=>b.power-a.power);

  let a=[], b=[], pa=0, pb=0;
  if(mode==='one'){
    a = autoPositions(list);
  } else {
    list.forEach(p=>{
      if(pa<=pb){ a.push(p); pa+=+p.power; } else { b.push(p); pb+=+p.power; }
    });
    a = autoPositions(a);
    b = autoPositions(b);
  }

  drawField(a,b);
}

// ======= SAHA Ã‡Ä°ZÄ°M =======
function drawField(teamA, teamB){
  teamsDiv.innerHTML='';

  const field = document.createElement('div');
  field.className='relative bg-green-800 border-4 border-white rounded w-full h-[400px] mx-auto';
  
  // Santra Ã§izgisi
  const centerLine = document.createElement('div');
  centerLine.className='absolute top-1/2 left-0 w-full border-t-2 border-white';
  field.appendChild(centerLine);

  // Kale alanlarÄ±
  const goalA = document.createElement('div');
  goalA.className='absolute top-[50%] -translate-y-1/2 left-0 w-10 h-24 bg-white/50 border-2 border-white';
  field.appendChild(goalA);

  const goalB = document.createElement('div');
  goalB.className='absolute top-[50%] -translate-y-1/2 right-0 w-10 h-24 bg-white/50 border-2 border-white';
  field.appendChild(goalB);

  // TakÄ±m A
  if(teamA){
    const positions = ['GK','DEF','MID','FWD'];
    positions.forEach((pos,i)=>{
      const line = document.createElement('div');
      line.className='absolute flex justify-center w-full';
      const top = 20 + i*60; // yatay pozisyon
      line.style.top = top + 'px';
      teamA.filter(p=>p.pos[0]===pos).forEach((p,j)=>{
        const player = document.createElement('div');
        player.className='absolute bg-yellow-500 text-black p-1 rounded text-xs text-center';
        player.textContent=p.name;
        player.style.left = (50 + j*60) + 'px';
        line.appendChild(player);
      });
      field.appendChild(line);
    });
  }

  // TakÄ±m B
  if(teamB){
    const positions = ['GK','DEF','MID','FWD'];
    positions.forEach((pos,i)=>{
      const line = document.createElement('div');
      line.className='absolute flex justify-center w-full';
      const top = 20 + i*60;
      line.style.top = top + 'px';
      teamB.filter(p=>p.pos[0]===pos).forEach((p,j)=>{
        const player = document.createElement('div');
        player.className='absolute bg-cyan-500 text-black p-1 rounded text-xs text-center';
        player.textContent=p.name;
        player.style.right = (50 + j*60) + 'px';
        line.appendChild(player);
      });
      field.appendChild(line);
    });
  }

  teamsDiv.appendChild(field);
}

// ======= RESÄ°M Ä°NDÄ°R =======
function shareImage(){
  if(!teamsDiv.innerHTML) return alert("Ã–nce takÄ±m oluÅŸtur");
  html2canvas(teamsDiv).then(c=>{
    const a=document.createElement('a');
    a.href=c.toDataURL('image/png');
    a.download='halisaha-takimlar.png';
    a.click();
  });
}

// ======= CACHE TEMÄ°ZLE =======
function clearCache(){
  localStorage.removeItem('players');
  players=[];
  renderPlayers();
  teamsDiv.innerHTML='';
  alert('Cache temizlendi');
}
</script>
</body>
</html>
