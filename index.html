<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kent BT Ekibi - Taktik TahtasÄ± v4.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <style>
        :root { --master-scale: 1; }
        body { background: #020617; color: #f8fafc; font-family: 'Inter', sans-serif; overflow-x: hidden; }
        #master-container { transform: scale(var(--master-scale)); transform-origin: top center; transition: transform 0.2s; }

        .kent-logo {
            font-size: 24px; font-weight: 900; letter-spacing: -1px;
            background: linear-gradient(to right, #10b981, #ffffff);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            text-transform: uppercase; filter: drop-shadow(0 0 10px rgba(16, 185, 129, 0.3));
        }

        .field { 
            width: 100%; height: 100%; min-height: 500px; background: #166534; border: 4px solid #fff; position: relative;
            background-image: repeating-linear-gradient(90deg, transparent, transparent 10%, rgba(0,0,0,0.03) 10%, rgba(0,0,0,0.03) 20%);
        }
        .box { position: absolute; border: 3px solid #fff; }
        .box-l { left: 0; top: 25%; width: 15%; height: 50%; border-left: 0; }
        .box-r { right: 0; top: 25%; width: 15%; height: 50%; border-right: 0; }
        
        .player {
            position: absolute; width: 90px; padding: 6px 2px; border-radius: 12px;
            text-align: center; font-weight: 800; font-size: 11px;
            cursor: grab; z-index: 20; transform: translate(-50%, -50%);
            box-shadow: 0 10px 15px rgba(0,0,0,0.4);
            user-select: none; transition: left 0.4s ease, top 0.4s ease;
        }
        .team-a { background: linear-gradient(135deg, #e11d48, #9f1239); border: 2px solid #fff; color: white; }
        .team-b { background: linear-gradient(135deg, #2563eb, #1e40af); border: 2px solid #fff; color: white; }
        .vest-on { background: #fbbf24 !important; color: #000 !important; border: 2px dashed #000 !important; transform: translate(-50%, -50%) scale(1.1); }

        .ui-panel { 
            background: rgba(15, 23, 42, 0.95); border: 1px solid #334155; 
            backdrop-filter: blur(12px); overflow: hidden; resize: both; 
            display: flex; flex-direction: column;
        }
        .panel-header { background: #1e293b; color: #94a3b8; font-size: 10px; font-weight: 900; padding: 10px; cursor: move; border-bottom: 1px solid #334155; text-transform: uppercase; }
        .player-card { width: 160px; flex-shrink: 0; transition: all 0.2s; }
        .player-card:hover { border-color: #10b981; background: rgba(15, 23, 42, 0.8); }
    </style>
</head>
<body class="p-2 sm:p-4">

<nav class="fixed top-0 left-0 w-full z-[100] bg-slate-900/95 border-b border-slate-800 p-4 flex flex-wrap items-center justify-between gap-4 shadow-2xl">
    <div class="flex items-center gap-6">
        <div class="kent-logo">KENT BT EKÄ°BÄ° SUNAR</div>
        <div class="flex items-center gap-2 bg-slate-950 px-3 py-1 rounded-full border border-slate-800">
            <span class="text-[10px] font-bold text-slate-500">ZOOM</span>
            <input type="range" min="0.5" max="1.3" step="0.1" value="1" id="zoomRange" oninput="changeZoom(this.value); saveAll();" class="w-24 accent-emerald-500">
        </div>
    </div>
    
    <div class="flex items-center gap-2">
        <button onclick="clearCache()" class="bg-rose-500/10 text-rose-500 px-4 py-2 rounded-xl text-[11px] font-black hover:bg-rose-500/20 transition-all">ðŸ§¹ TEMÄ°ZLE</button>
        <button onclick="resetLayout()" class="bg-slate-800 text-slate-300 px-4 py-2 rounded-xl text-[11px] font-black hover:bg-slate-700 transition-all">ðŸ”„ DÃœZEN</button>
        <button onclick="exportImage()" class="bg-emerald-600 text-white px-6 py-2 rounded-xl text-[11px] font-black shadow-lg hover:bg-emerald-500 transition-all">ðŸ“¸ Ä°NDÄ°R</button>
    </div>
</nav>

<div id="master-container" class="pt-28 pb-10">
    <div class="max-w-full mx-auto space-y-6 px-4">
        
        <div id="panelInputs" class="ui-panel rounded-3xl shadow-2xl w-full" data-id="main-panel">
            <div class="panel-header">TAKIM YÃ–NETÄ°MÄ°</div>
            <div class="p-4 bg-slate-900/40 border-b border-slate-800 flex flex-wrap items-center gap-4 shrink-0">
                <select id="playerCount" onchange="updatePlayerList(); saveAll();" class="bg-slate-950 text-white px-4 py-2 rounded-xl text-xs font-black border border-slate-800 outline-none"></select>
                <button onclick="distributeAndAlign()" class="bg-indigo-600 px-6 py-2 rounded-xl text-[10px] font-black text-white hover:bg-indigo-500 shadow-lg shadow-indigo-900/20 transition-all">KADRO KUR & KARIÅžTIR</button>
                <button onclick="randomVest()" class="bg-amber-500 px-6 py-2 rounded-xl text-[10px] font-black text-black ml-auto hover:bg-amber-400 transition-all">YELEK AT</button>
            </div>
            <div id="playerInputs" class="p-6 flex flex-wrap justify-center gap-4 overflow-y-auto max-h-[400px]"></div>
        </div>

        <div class="flex flex-col lg:flex-row gap-6 items-stretch">
            <div id="panelA" class="ui-panel w-full lg:w-72 rounded-3xl" data-id="panelA">
                <div class="panel-header">A TAKIMI AYARLARI</div>
                <div class="p-6 space-y-6 flex-1 flex flex-col justify-center">
                    <select id="tacticA" onchange="realignOnly(); saveAll();" class="w-full bg-slate-950 p-3 rounded-xl text-xs font-bold border border-slate-800 text-white">
                        <option value="3-1-2">3-1-2</option><option value="2-2-2">2-2-2</option><option value="3-2-1">3-2-1</option>
                    </select>
                    <div class="space-y-4">
                        <div class="space-y-1"><p class="text-[9px] font-bold text-rose-400">DEFANS HATTI</p><input type="range" id="slider-a-DEF" oninput="moveLine('a', 'DEF', this.value); saveAll();" min="-120" max="120" value="0" class="w-full accent-rose-500"></div>
                        <div class="space-y-1"><p class="text-[9px] font-bold text-rose-400">ORTA SAHA HATTI</p><input type="range" id="slider-a-MID" oninput="moveLine('a', 'MID', this.value); saveAll();" min="-120" max="120" value="0" class="w-full accent-rose-500"></div>
                        <div class="space-y-1"><p class="text-[9px] font-bold text-rose-400">HÃœCUM HATTI</p><input type="range" id="slider-a-FWD" oninput="moveLine('a', 'FWD', this.value); saveAll();" min="-120" max="120" value="0" class="w-full accent-rose-500"></div>
                    </div>
                </div>
            </div>

            <div id="panelField" class="ui-panel flex-1 rounded-3xl min-h-[550px]" data-id="panelField">
                <div class="panel-header">TAKTÄ°K SAHASI</div>
                <div id="field" class="field rounded-2xl overflow-hidden flex-1">
                    <div class="absolute left-1/2 top-0 w-0.5 h-full bg-white/30"></div>
                    <div class="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-40 h-40 border-2 border-white/30 rounded-full"></div>
                    <div class="box box-l"></div><div class="box box-r"></div>
                    <div id="ball" class="absolute w-12 h-12 bg-white rounded-full flex items-center justify-center cursor-grab z-[100] text-2xl shadow-2xl border-4 border-slate-200" style="left:50%; top:50%; transform: translate(-50%, -50%)">âš½</div>
                </div>
            </div>

            <div id="panelB" class="ui-panel w-full lg:w-72 rounded-3xl" data-id="panelB">
                <div class="panel-header">B TAKIMI AYARLARI</div>
                <div class="p-6 space-y-6 flex-1 flex flex-col justify-center">
                    <select id="tacticB" onchange="realignOnly(); saveAll();" class="w-full bg-slate-950 p-3 rounded-xl text-xs font-bold border border-slate-800 text-white">
                        <option value="3-1-2">3-1-2</option><option value="2-2-2">2-2-2</option><option value="3-2-1">3-2-1</option>
                    </select>
                    <div class="space-y-4">
                        <div class="space-y-1"><p class="text-[9px] font-bold text-blue-400">DEFANS HATTI</p><input type="range" id="slider-b-DEF" oninput="moveLine('b', 'DEF', this.value); saveAll();" min="-120" max="120" value="0" class="w-full accent-blue-500"></div>
                        <div class="space-y-1"><p class="text-[9px] font-bold text-blue-400">ORTA SAHA HATTI</p><input type="range" id="slider-b-MID" oninput="moveLine('b', 'MID', this.value); saveAll();" min="-120" max="120" value="0" class="w-full accent-blue-500"></div>
                        <div class="space-y-1"><p class="text-[9px] font-bold text-blue-400">HÃœCUM HATTI</p><input type="range" id="slider-b-FWD" oninput="moveLine('b', 'FWD', this.value); saveAll();" min="-120" max="120" value="0" class="w-full accent-blue-500"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
let players = [];
let activeDrag = null, startX, startY, initialX, initialY, dragType = "";

// HÃ¼seyin DoÄŸan KontrolÃ¼
function checkHuseyin(val, index, inputEl) {
    if (val.toLowerCase().trim() === "hÃ¼seyin doÄŸan") {
        alert("Ne hÃ¼seyinmi kaÃ§ kaÃ§ kaÃ§");
        players[index].name = "";
        inputEl.value = "";
        saveAll();
        return true;
    }
    return false;
}

function saveAll() {
    const data = {
        players: players,
        playerCount: document.getElementById('playerCount').value,
        tacticA: document.getElementById('tacticA').value,
        tacticB: document.getElementById('tacticB').value,
        zoom: document.getElementById('zoomRange').value,
        sliders: {
            aDEF: document.getElementById('slider-a-DEF').value, aMID: document.getElementById('slider-a-MID').value, aFWD: document.getElementById('slider-a-FWD').value,
            bDEF: document.getElementById('slider-b-DEF').value, bMID: document.getElementById('slider-b-MID').value, bFWD: document.getElementById('slider-b-FWD').value
        },
        panelStyles: {}
    };
    document.querySelectorAll('.ui-panel').forEach(p => {
        data.panelStyles[p.dataset.id] = { width: p.style.width, height: p.style.height, top: p.style.top, left: p.style.left, position: p.style.position || 'relative' };
    });
    localStorage.setItem('kentBT_TacticSave_v5', JSON.stringify(data));
}

function loadAll() {
    const sel = document.getElementById('playerCount');
    for(let i=2; i<=22; i+=2) {
        let opt = document.createElement('option'); opt.value = i; opt.innerText = `${i} Oyuncu`;
        if(i===12) opt.selected = true; sel.appendChild(opt);
    }
    const saved = localStorage.getItem('kentBT_TacticSave_v5');
    if(!saved) { updatePlayerList(); initPanelControls(); return; }
    const data = JSON.parse(saved);
    players = data.players;
    document.getElementById('playerCount').value = data.playerCount;
    document.getElementById('tacticA').value = data.tacticA;
    document.getElementById('tacticB').value = data.tacticB;
    document.getElementById('zoomRange').value = data.zoom;
    changeZoom(data.zoom);
    document.getElementById('slider-a-DEF').value = data.sliders.aDEF;
    document.getElementById('slider-a-MID').value = data.sliders.aMID;
    document.getElementById('slider-a-FWD').value = data.sliders.aFWD;
    document.getElementById('slider-b-DEF').value = data.sliders.bDEF;
    document.getElementById('slider-b-MID').value = data.sliders.bMID;
    document.getElementById('slider-b-FWD').value = data.sliders.bFWD;
    
    Object.keys(data.panelStyles).forEach(id => {
        const p = document.querySelector(`[data-id="${id}"]`);
        if(p) Object.assign(p.style, data.panelStyles[id]);
    });
    
    updatePlayerList(true);
    distributeAndAlign();
    initPanelControls();
}

function updatePlayerList(isLoad = false) {
    const count = parseInt(document.getElementById('playerCount').value);
    if(!isLoad) {
        players = Array.from({length: count}, (_, i) => players[i] || { 
            id: i, name: "", quality: 5, positions: (i < 2 ? ["GK"] : ["MID"]) 
        });
    }
    const container = document.getElementById('playerInputs');
    container.innerHTML = players.slice(0, count).map((p, i) => `
        <div class="player-card bg-slate-900/60 p-4 rounded-2xl border border-slate-800 space-y-3 shadow-inner">
            <input type="text" placeholder="OYUNCU ${i+1}" value="${p.name}" 
                   oninput="if(!checkHuseyin(this.value, ${i}, this)) { players[${i}].name=this.value; saveAll(); }" 
                   class="w-full bg-slate-950 p-2 text-[10px] rounded-lg font-black border border-slate-800 outline-none text-emerald-400 uppercase">
            
            <div class="flex justify-between items-center text-[9px] font-black text-slate-500 uppercase">
                <span>KALÄ°TE: ${p.quality}</span>
                <input type="range" min="1" max="10" value="${p.quality}" 
                       oninput="players[${i}].quality=parseInt(this.value); this.previousElementSibling.innerText='KALÄ°TE: '+this.value; saveAll();" 
                       class="w-16 accent-emerald-500">
            </div>

            <div class="grid grid-cols-2 gap-1">
                ${["GK","DEF","MID","FWD"].map(pos => `
                    <button onclick="togglePos(${i},'${pos}')" 
                            class="text-[8px] py-1.5 rounded-lg font-black transition-all ${p.positions.includes(pos) ? 'bg-emerald-600 text-white' : 'bg-slate-800 text-slate-500'}">
                        ${pos}
                    </button>`).join('')}
            </div>
        </div>`).join('');
}

function togglePos(idx, pos) {
    let p = players[idx];
    if(p.positions.includes(pos)) {
        if(p.positions.length > 1) p.positions = p.positions.filter(x => x !== pos);
    } else {
        p.positions.push(pos);
    }
    updatePlayerList(true);
    saveAll();
}

function distributeAndAlign() {
    const count = parseInt(document.getElementById('playerCount').value);
    document.querySelectorAll('.player:not(#ball)').forEach(e => e.remove());

    // Kaliteye gÃ¶re sÄ±rala (Adil daÄŸÄ±lÄ±m iÃ§in)
    let pool = [...players].slice(0, count).sort((a,b) => b.quality - a.quality);
    
    // Her basÄ±ÅŸta rastgelelik iÃ§in ikili gruplarÄ± kendi iÃ§inde karÄ±ÅŸtÄ±r
    let teamA = [], teamB = [];
    for(let i=0; i < pool.length; i+=2) {
        if(Math.random() > 0.5) {
            teamA.push(pool[i]); if(pool[i+1]) teamB.push(pool[i+1]);
        } else {
            teamB.push(pool[i]); if(pool[i+1]) teamA.push(pool[i+1]);
        }
    }

    alignTeam(teamA, 'a', document.getElementById('tacticA').value);
    alignTeam(teamB, 'b', document.getElementById('tacticB').value);
}

function alignTeam(teamArr, teamName, tacKey) {
    const tac = {
        "3-1-2": { GK:[8,50], DEF:[[28,20],[28,50],[28,80]], MID:[[55,50]], FWD:[[82,30],[82,70]] },
        "2-2-2": { GK:[8,50], DEF:[[28,30],[28,70]], MID:[[55,30],[55,70]], FWD:[[82,30],[82,70]] },
        "3-2-1": { GK:[8,50], DEF:[[28,20],[28,50],[28,80]], MID:[[62,30],[62,70]], FWD:[[88,50]] }
    }[tacKey];

    let slots = [
        {role:'GK', pos:tac.GK, taken: false},
        ...tac.DEF.map(p=>({role:'DEF',pos:p, taken: false})),
        ...tac.MID.map(p=>({role:'MID',pos:p, taken: false})),
        ...tac.FWD.map(p=>({role:'FWD',pos:p, taken: false}))
    ];

    teamArr.forEach((player) => {
        let foundSlot = slots.find(s => player.positions.includes(s.role) && !s.taken) || slots.find(s => !s.taken);
        if(foundSlot) {
            foundSlot.taken = true;
            const el = document.createElement('div');
            el.className = `player team-${teamName}`;
            el.innerHTML = `
                <div class="w-full truncate px-1 uppercase leading-tight">${player.name || 'OYUNCU'}</div>
                <div class="text-[7px] opacity-60 font-black">${foundSlot.role}</div>`;
            
            let fx = teamName === 'a' ? foundSlot.pos[0]/2 : 100 - foundSlot.pos[0]/2;
            el.style.left = fx + "%"; el.style.top = foundSlot.pos[1] + "%";
            el.dataset.baseX = fx; el.dataset.role = foundSlot.role; el.dataset.team = teamName;
            
            makeDraggable(el, "player");
            document.getElementById('field').appendChild(el);
        }
    });
}

function makeDraggable(el, type) {
    el.onmousedown = el.ontouchstart = (e) => {
        if(e.target.tagName === 'INPUT' || e.target.tagName === 'SELECT') return;
        activeDrag = el; dragType = type;
        const ev = e.touches ? e.touches[0] : e;
        const scale = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--master-scale'));
        startX = ev.clientX; startY = ev.clientY;
        initialX = el.offsetLeft; initialY = el.offsetTop;
        el.style.transition = "none";
        el.style.zIndex = 2000;
    };
}

window.onmousemove = window.ontouchmove = (e) => {
    if(!activeDrag) return;
    const ev = e.touches ? e.touches[0] : e;
    const scale = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--master-scale'));
    if(dragType === "panel") {
        activeDrag.style.left = (initialX + (ev.clientX - startX)) + "px";
        activeDrag.style.top = (initialY + (ev.clientY - startY)) + "px";
    } else {
        activeDrag.style.left = (initialX + (ev.clientX - startX) / scale) + "px";
        activeDrag.style.top = (initialY + (ev.clientY - startY) / scale) + "px";
    }
};

window.onmouseup = window.ontouchend = () => {
    if(activeDrag) {
        if(dragType === "player") activeDrag.style.transition = "left 0.4s ease, top 0.4s ease";
        saveAll();
    }
    activeDrag = null;
};

function moveLine(t, r, v) {
    document.querySelectorAll('.player').forEach(el => {
        if(el.dataset.team === t && el.dataset.role === r) {
            el.style.left = `calc(${el.dataset.baseX}% + ${v}px)`;
        }
    });
}

function changeZoom(v) { document.documentElement.style.setProperty('--master-scale', v); }
function clearCache() { if(confirm("KENT BT: TÃ¼m veriler silinsin mi?")) { localStorage.clear(); location.reload(); } }
function resetLayout() { document.querySelectorAll('.ui-panel').forEach(p => p.style = ""); saveAll(); }
function randomVest() {
    const t = Math.random() > 0.5 ? 'a' : 'b';
    document.querySelectorAll('.player').forEach(p => {
        p.classList.remove('vest-on');
        if(p.classList.contains(`team-${t}`)) p.classList.add('vest-on');
    });
}
function exportImage() {
    html2canvas(document.getElementById('field'), { scale: 3 }).then(canvas => {
        const link = document.createElement('a');
        link.download = 'kent_bt_taktik.png'; link.href = canvas.toDataURL(); link.click();
    });
}
function realignOnly() { distributeAndAlign(); }
function initPanelControls() {
    document.querySelectorAll('.ui-panel').forEach(panel => {
        const header = panel.querySelector('.panel-header');
        header.onmousedown = header.ontouchstart = (e) => {
            activeDrag = panel; dragType = "panel";
            panel.style.position = "absolute";
            const ev = e.touches ? e.touches[0] : e;
            startX = ev.clientX; startY = ev.clientY;
            initialX = panel.offsetLeft; initialY = panel.offsetTop;
            panel.style.zIndex = 1000;
        };
    });
}

makeDraggable(document.getElementById('ball'), "player");
loadAll();
</script>
</body>
</html>
